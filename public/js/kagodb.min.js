/*! kagodb 0.2.34 */
!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.KagoDB=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("./common"),d=c.inherit();d.bundle.jquery=a("../lib/ajax/jquery"),d.bundle.superagent=a("../lib/ajax/superagent"),d.bundle.base=a("../lib/core/base"),d.bundle.cursor=a("../lib/core/cursor"),d.bundle.cursor_bulk=a("../lib/core/cursor_bulk"),d.bundle.objectid=a("../lib/core/objectid"),d.bundle.system=a("../lib/core/system"),d.bundle.utils=a("../lib/core/utils"),d.bundle.deny=a("../lib/mixin/deny"),d.bundle.dynamic_ajax=a("../lib/mixin/dynamic_ajax"),d.bundle.dynamic_mixin=a("../lib/mixin/dynamic_mixin"),d.bundle.dynamic_storage=a("../lib/mixin/dynamic_storage"),d.bundle.encode=a("../lib/mixin/encode"),d.bundle.events=a("../lib/mixin/events"),d.bundle.http_more=a("../lib/mixin/http_more"),d.bundle.init=a("../lib/mixin/init"),d.bundle.intercept_mixin=a("../lib/mixin/intercept_mixin"),d.bundle.model=a("../lib/mixin/model"),d.bundle.noop=a("../lib/mixin/noop"),d.bundle.obop=a("../lib/mixin/obop"),d.bundle.pkey=a("../lib/mixin/pkey"),d.bundle.stub=a("../lib/mixin/stub"),d.bundle.count=a("../lib/query/count"),d.bundle.find=a("../lib/query/find"),d.bundle.find_and_modify=a("../lib/query/find_and_modify"),d.bundle.find_one=a("../lib/query/find_one"),d.bundle.insert=a("../lib/query/insert"),d.bundle.remove=a("../lib/query/remove"),d.bundle.update=a("../lib/query/update"),d.bundle.ajax=a("../lib/storage/ajax"),d.bundle.local_storage=a("../lib/storage/local_storage"),d.bundle.memory=a("../lib/storage/memory"),b.exports=d},{"../lib/ajax/jquery":3,"../lib/ajax/superagent":4,"../lib/core/base":5,"../lib/core/cursor":6,"../lib/core/cursor_bulk":7,"../lib/core/objectid":8,"../lib/core/system":9,"../lib/core/utils":11,"../lib/mixin/deny":12,"../lib/mixin/dynamic_ajax":13,"../lib/mixin/dynamic_mixin":14,"../lib/mixin/dynamic_storage":15,"../lib/mixin/encode":16,"../lib/mixin/events":17,"../lib/mixin/http_more":18,"../lib/mixin/init":19,"../lib/mixin/intercept_mixin":20,"../lib/mixin/model":21,"../lib/mixin/noop":22,"../lib/mixin/obop":23,"../lib/mixin/pkey":24,"../lib/mixin/stub":25,"../lib/query/count":26,"../lib/query/find":27,"../lib/query/find_and_modify":28,"../lib/query/find_one":29,"../lib/query/insert":30,"../lib/query/remove":31,"../lib/query/update":32,"../lib/storage/ajax":33,"../lib/storage/local_storage":34,"../lib/storage/memory":35,"./common":2}],2:[function(a,b){var c=a("../lib/core/base"),d=a("../lib/query/count"),e=a("../lib/query/find"),f=a("../lib/query/find_and_modify"),g=a("../lib/query/find_one"),h=a("../lib/query/insert"),i=a("../lib/query/remove"),j=a("../lib/query/update"),k=a("../lib/mixin/dynamic_ajax"),l=a("../lib/mixin/dynamic_storage"),m=a("../lib/mixin/encode"),n=a("../lib/mixin/events"),o=a("../lib/mixin/init"),p=a("../lib/mixin/model"),q=a("../lib/mixin/noop"),r=a("../lib/mixin/obop"),s=a("../lib/mixin/pkey"),t=c.inherit();t.mixin(q()),t.mixin(o()),t.mixin(k()),t.mixin(m()),t.mixin(d()),t.mixin(e()),t.mixin(f()),t.mixin(g()),t.mixin(h()),t.mixin(i()),t.mixin(j()),t.mixin(l()),t.mixin(n()),t.mixin(s()),t.mixin(r()),t.mixin(p()),b.exports=t},{"../lib/core/base":5,"../lib/mixin/dynamic_ajax":13,"../lib/mixin/dynamic_storage":15,"../lib/mixin/encode":16,"../lib/mixin/events":17,"../lib/mixin/init":19,"../lib/mixin/model":21,"../lib/mixin/noop":22,"../lib/mixin/obop":23,"../lib/mixin/pkey":24,"../lib/query/count":26,"../lib/query/find":27,"../lib/query/find_and_modify":28,"../lib/query/find_one":29,"../lib/query/insert":30,"../lib/query/remove":31,"../lib/query/update":32}],3:[function(a,b,c){var d=a("wrequire"),c=b.exports=function(){var a={ajax:c.ajax};return a};c.ajax=function(a,b){var c=this,e={},f=this.get("jquery");if(f=f||d("jQuery","jquery"),!f)throw new Error("jQuery not loaded");c.emit&&c.emit("ajax",a),e.type=a.method||"GET",e.url=a.url,e.dataType="json",a.json?(e.headers={"Content-Type":"application/json"},e.data=JSON.stringify(a.json)):a.form&&(e.data=a.form),c.emit&&c.emit("request",e),f.ajax(e).fail(function(a,d,e){c.emit&&c.emit("response",a),e instanceof Error||(a=a||{},d=a.status||d,e=a.responseText||e||"",e=new Error(d+" "+e)),b(e)}).done(function(a,d,e){c.emit&&c.emit("response",e),b(null,a)})}},{wrequire:44}],4:[function(a,b,c){var d=a("wrequire"),c=b.exports=function(){var a={ajax:c.ajax};return a};c.ajax=function(a,b){var c=this,e=a.method||"GET",f=a.url,g=this.get("superagent");if(g=g||d("superagent","superagent"),!g)throw new Error("superagent not loaded");c.emit&&c.emit("ajax",a),e=e.toLowerCase(),e="delete"==e?"del":e;var h=g[e](f);h.set("Accept","application/json"),a.json?h.type("json").send(a.json):a.form&&("get"==e?h.query(a.form):h.type("form").send(a.form)),c.emit&&c.emit("request",h),h.end(function(a,d){c.emit&&c.emit("response",d),a?b(a,d):(d.ok||(a=new Error(d.status)),b(a,d.body))})}},{wrequire:44}],5:[function(a,b){function c(a){function b(a){return this instanceof b?(this.set(b.settings),void this.set(a)):new b(a)}return f.inherits(b,a),b.settings=f.clone(a.settings),b.prototype.bundle=b.bundle=f.clone(a.bundle||{}),b.mixin=function(a){return e(b.prototype,a),b},b.inherit=function(){var a=c(b);return arguments.length&&a.set.apply(a,arguments),a},b.get=function(a){var c=b.settings||(b.settings={});return c[a]},b.set=function(a,c){var d=b.settings||(b.settings={}),e=arguments.length;if(2==e&&a)d[a]=c;else if(1==e&&"object"==typeof a){var f=a;for(a in f)d[a]=f[a]}else if(e>1||"undefined"!=typeof a)throw new Error("invalid set("+a+", "+c+")");return b},b}function d(){}function e(a,b){if("function"==typeof b)b=b.call(a),b&&e(a,b);else{if("object"!=typeof b)throw new Error("invalid mixin("+b+")");for(var c in b)a[c]=b[c]}}var f=a("./utils");d.prototype.get=function(a){var b=this.settings||(this.settings={});return b[a]},d.prototype.set=function(a,b){var c=this.settings||(this.settings={}),d=arguments.length;if(2==d&&a)c[a]=b;else if(1==d&&"object"==typeof a){var e=a;for(a in e)c[a]=e[a]}else if(d>1||"undefined"!=typeof a)throw new Error("invalid set("+a+", "+b+")");return this},d.prototype.mixin=function(a){return e(this,a),this},b.exports=c(d)},{"./utils":11}],6:[function(a,b){function c(){}function d(a,b,c){if(this.collection=a,this.source=new e(this),this._source=this.source,this.obop=a.obop(),b){try{b=this.obop.where(b)}catch(d){b=null,this._error=d}b&&(this.source=new f(this,b))}if(c){try{c=this.obop.view(c)}catch(d){c=null,this._error=d}c&&(this.source=new j(this,c))}}function e(a){this.collection=a.collection}function f(a,b){this.source=a.source,this.condition=b}function g(a,b){this.source=a.source;try{this.sorter=a.obop.order(b)}catch(c){this._error=c}}function h(a,b){this.source=a.source,this.offset=b}function i(a,b){this.source=a.source,this.limit=b,this.rest=b}function j(a,b){this.source=a.source,this.projection=b}function k(a,b){function c(e,f){return e?void b(e):f?(d.push(f),void a.nextObject(c)):void b(null,d)}var d=[];b=b||l,a.nextObject(c)}function l(){}var m=a("./utils");b.exports=d,c.prototype.nextObject=function(a){if(!this.source)throw new Error("no source");this.source.nextObject(a)},c.prototype.rewind=function(){if(!this.source)throw new Error("no source");return this.source.rewind&&this.source.rewind(),this},m.inherits(d,c),d.prototype.index=function(a){var b=this;if(a=a||l,this._error)return a(this._error),this;if(b._index){var c=[].concat(b._index);a(null,c)}else b.collection.index(function(c,d){c?a(c):(b._index=d,d=[].concat(b._index),a(null,d))});return this},d.prototype.toArray=function(a){var b=this;if(a=a||l,this._error)return a(this._error),this;if(b._toArray){var c=[].concat(b._toArray);a(null,c)}else k(this.source,function(c,d){c?a(c):(b._toArray=d,d=[].concat(b._toArray),a(null,d))});return this},d.prototype.each=function(a){function b(d,e){a(d,e),!d&&e&&c.nextObject(b)}var c=this;return a=a||l,this._error?(a(this._error),this):void this.nextObject(b)},d.prototype.count=function(a){if(a=a||l,this._error)return a(this._error),this;var b=this.source===this._source?this.index:this.toArray;return b.call(this,function(b,c){b?a(b):a(null,c.length)}),this},d.prototype.sort=function(a){return this.source=new g(this,a),this},d.prototype.offset=function(a){return this.source=new h(this,a),this},d.prototype.limit=function(a){return this.source=new i(this,a),this},m.inherits(e,c),e.prototype.nextObject=function(a){var b=this;if(a=a||l,this.list){if(this.list.length){var c=this.list.shift();return void this.collection.read(c,a)}return void a()}return this.collection.index(function(c,d){return c?a(c):(b.list=d||[],void b.nextObject(a))}),this},e.prototype.rewind=function(){delete this.list},m.inherits(f,c),f.prototype.nextObject=function(a){function b(e,f){e?a(e):f?d(f)?a(null,f):c.nextObject(b):a()}var c=this.source,d=this.condition;if("function"!=typeof d){var e=new Error("invalid condition: "+d);return void a(e)}c.nextObject(b)},m.inherits(g,c),g.prototype.nextObject=function(a){var b=this;if(a=a||l,this._error)return void a(this._error);if(this.list){var c=this.list.shift();return void a(null,c)}k(this.source,function(c,d){return c?a(c):(d=d||[],b.list=d.sort(b.sorter),void b.nextObject(a))})},g.prototype.rewind=function(){delete this.list,this.source.rewind&&this.source.rewind()},m.inherits(h,c),h.prototype.nextObject=function(a){function b(f,g){f?a(f):g?--d>0?e.nextObject(b):(c.ready=!0,e.nextObject(a)):a()}var c=this,d=this.offset,e=this.source;a=a||l,e.nextObject(this.ready||0>=d?a:b)},h.prototype.rewind=function(){delete this.ready,c.prototype.rewind.call(this)},m.inherits(i,c),i.prototype.nextObject=function(a){var b=this.source;a=a||l,this.rest-->0?b.nextObject(a):a()},i.prototype.rewind=function(){this.rest=this.limit,c.prototype.rewind.call(this)},m.inherits(j,c),j.prototype.nextObject=function(a){var b=this.projection;if("function"!=typeof b){var c=new Error("invalid projection: "+b);return void a(c)}this.source.nextObject(function(c,d){c?a(c):d?(d=b(d),a(null,d)):a()})}},{"./utils":11}],7:[function(a,b){function c(a,b,c,d){this.settings=d||{},this.collection=a,this._condition=b,this._projection=c}function d(){}a("../core/utils");b.exports=c,c.prototype.toArray=function(a){if(a=a||d,this.cache){var b=[].concat(this.cache);a(b)}else{var c=this._cursor();c.toArray(function(b,c){!b&&c&&(this.cache=c,c=[].concat(this.cache)),a(b,c)})}},c.prototype._cursor=function(){var a=this.collection,b=this._condition,c=this._projection,d=this.settings,e=a.find(b,c,d);return e},c.prototype.count=function(a){var b=this._cursor();return b.count?void b.count(a):void b.toArray(function(b,c){b?a(b):(c=c||[],a(null,c.length))})},c.prototype.sort=function(a){return this.settings.sort=a,this},c.prototype.offset=function(a){return this.settings.skip=a,this},c.prototype.limit=function(a){return this.settings.limit=a,this},c.prototype.each=function(a){function b(d,e){a(d,e),!d&&e&&c.nextObject(b)}var c=this;a=a||d,this.nextObject(b)},c.prototype.nextObject=function(a){var b=this;if(a=a||d,this.list){if(!this.list.length)return a();var c=this.list.shift();a(null,c)}else this.toArray(function(c,d){return c?a(c):(b.list=d||[],void b.nextObject(a))});return this},c.prototype.rewind=function(){delete this.list}},{"../core/utils":11}],8:[function(a,b){function c(a){if(!(this instanceof c))return new c(a);var b;if(a instanceof c?b=a.$oid:"object"==typeof a&&a&&a.$oid?b=a.$oid:"string"==typeof a&&(b=a),b){if(24==b.length)this.$oid=b;else if(12==b.length)this.$oid=d(b);else if(b.length>0)throw new Error("Invalid source ObjectID: "+a)}else this.$oid=e(a)}function d(a){for(var b=[],c=a.length,d=0;c>d;d++){var e=a.charCodeAt(d),f=e.toString(16);1==f.length&&(f="0"+f),b.push(f)}return b.join("")}function e(a){var b=a instanceof Date?a:new Date,d=Math.floor(b.getTime()/1e3),e=c._machineId||(c._machineId=Math.floor(16777216*Math.random())),f=c._processId||(c._processId=Math.floor(65536*Math.random()));c._globalSeq||(c._globalSeq=0);var g=++c._globalSeq,h=("00000000"+d.toString(16)).substr(-8,8),i=("000000"+e.toString(16)).substr(-6,6),j=("0000"+f.toString(16)).substr(-4,4),k=("000000"+g.toString(16)).substr(-6,6),l=[h,i,j,k];return l.join("")}b.exports=c,c.prototype={getGenerationTime:function(){return parseInt(this.$oid.substr(0,8),16)},setGenerationTime:function(a){var b=("00000000"+a.toString(16)).substr(-8,8),c=this.$oid.substr(8),d=[b,c];this.$oid=d.join("")},toHexString:function(){return this.$oid},getTimestamp:function(){var a=parseInt(this.$oid.substr(0,8),16);return new Date(1e3*a)},equals:function(a){return this+""==a},toOctets:function(){for(var a=this.toHexString(),b=[],c=a.length,d=0;c>d;d+=2){var e=a.substr(d,2),f=parseInt(e,16);b.push(f)}return String.fromCharCode.apply(null,b)}},c.prototype.valueOf=c.prototype.toHexString,c.prototype.toString=c.prototype.toHexString,c.prototype.toJSON=c.prototype.toHexString,c.createFromTime=function(a){a=Math.floor(a)||0;var b=("00000000"+a.toString(16)).substr(-8,8),d="000000",e="0000",f="000000",g=[b,d,e,f],h=g.join("");return new c(h)},c.createFromHexString=function(a){return new c(a)}},{}],9:[function(a,b,c){var d=a("./system.json");c.version=function(){return d.version}},{"./system.json":10}],10:[function(a,b){b.exports={name:"kagodb",version:"0.2.34"}},{}],11:[function(a,b,c){function d(){}c.inherits=function(a,b){b=b||function(){},a=a||function(){b.apply(this,arguments)};var c=function(){};return c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.super_=b,a},c.eachSeries=function(a,b,c){function e(a){if(a)c(a);else if(f.length){var d=f.shift();b(d,e)}else c()}b=b||d,c=c||d;var f=[].concat(a);e()},c.extend=function(a,b){b=b||{};for(var c in b)a[c]=b[c];return a},c.clone=function(a){var b={};for(var c in a)b[c]=a[c];return b},c.bless=function(a,b){if(b&&"object"==typeof a){if(a.__proto__)a.__proto__=b.prototype;else{var c=new b;for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);a=c}return a}}},{}],12:[function(a,b){b.exports=function(a,b){function c(a,c){var d,e=b||new Error("method denied: "+a);return c=parseInt(c,10),d=c>=0?function(){var a=arguments[c];if("function"!=typeof a)throw e;a(e)}:0>c?function(){var a=arguments[arguments.length+c];if("function"!=typeof a)throw e;a(e)}:function(){throw e}}var d={};for(var e in a)d[e]=c(e,a[e]);return d}},{}],13:[function(a,b){function c(){if(this._ajax||(this.bundle.superagent&&this.get("superagent")?this._ajax=this.bundle.superagent.ajax:this.bundle.jquery&&(this.get("jquery")||e("jQuery"))?this._ajax=this.bundle.jquery.ajax:this.bundle.request&&(this._ajax=this.bundle.request.ajax)),!this._ajax)throw new Error('ajax driver is not specified at "ajax" option: '+this.get("ajax"));this._ajax.apply(this,arguments)}var d=a("../mixin/stub"),e=a("wrequire"),f=a("../mixin/dynamic_mixin"),g={ajax:c};b.exports=function(){function a(){return d(g).call(this),f("ajax")}return a}},{"../mixin/dynamic_mixin":14,"../mixin/stub":25,wrequire:44}],14:[function(a,b){function c(a){var b=this.get(a);if(!b)return null;this.emit("dynamic_mixin",a,b);var c=b+"";if("function"!=typeof b){var d=this.bundle||{};if(b=d[c],!b)throw new Error("invalid "+a+" class: "+c)}for(;"function"==typeof b;)b=b.call(this);for(var e in b)this[e]||(this[e]=b[e]);return b}var d=a("../mixin/intercept_mixin");b.exports=function(a){function b(){return d.call(this,e)}function e(b,d){return function(){var e=this[f];e||(e=c.call(this,a),e&&(this[f]=e));var g=e&&e[b]||d;return g.apply(this,arguments)}}var f="_"+a+"_dynamic_mixin";return b}},{"../mixin/intercept_mixin":20}],15:[function(a,b){var c=a("../mixin/stub"),d=a("../mixin/dynamic_mixin"),e={read:1,write:1,erase:1,exist:1,index:1,find:1,findOne:1,count:1,insert:1,save:1,update:1,findAndModify:1,remove:1,memory_store:1,file_folder:1,file_suffix:1,http_endpoint:1,http_param:1};b.exports=function(){return function(){return c(e).call(this),d("storage")}}},{"../mixin/dynamic_mixin":14,"../mixin/stub":25}],16:[function(a,b){function c(a,b){var c;try{c=JSON.parse(a)}catch(d){return void b(d)}this.unwrap&&(c=this.unwrap(c)),b(null,c)}function d(a,b){var c,d=this.get("json_replacer"),e=this.get("json_spaces");this.wrap&&(a=this.wrap(a));try{c=JSON.stringify(a,d,e)}catch(f){b(f)}b(null,c)}b.exports=function(){var a={};return a.decode=c,a.encode=d,a.escape=encodeURIComponent,a.unescape=decodeURIComponent,a}},{}],17:[function(a,b){function c(a,b){var c=this._events||(this._events={}),d=c[a]||(c[a]=[]);return d.push(b),this}function d(a,b){var c,d=this._events;return d?a?(c=d[a])?b?(d[a]=c.filter(function(a){return b!=a}),this):(delete d[a],this):this:(delete this._events,this):this}function e(a,b){var c=this,d=function(){d.done||(c.off(a,b),b.apply(this,arguments),d.done=!0)};return this.on(a,d),this}function f(a){var b,c,d=this,e=this._events;return e&&(b=e[a])?(c=Array.prototype.slice.call(arguments),c.shift(),b.forEach(function(a){a.apply(d,c)}),this):void 0}b.exports=function(){var a={};return a.on=c,a.off=d,a.once=e,a.emit=f,a}},{}],18:[function(a,b){function c(a,b,c){c=c||{};var e=function(){};e.prototype=this;var f=new e;return f.find=d,new n(f,a,b,c)}function d(a,b,c){var d=this,e=this.http_endpoint(),f=this.http_param();f.options=c,f.method="find",a&&(f.condition=a),b&&(f.projection=b);var g={method:"POST",url:e,json:f},h={};return h.toArray=function(a){function b(b,c){if(a=a||m,b)a(b);else if(c&&c.data instanceof Array){var e=c.data;if(d.unwrap){var f=d.unwrap.bind(d);e=e.map(f)}a(b,e)}else b=new Error('ajax response has no "data" property'),a(b)}d.ajax(g,b)},h}function e(a,b,c){function d(a,b){c=c||m,!a&&e.unwrap&&(b=e.unwrap.call(e,b)),c(a,b)}"function"!=typeof b||c||(c=b,b=null),b=b||{};var e=this,f=this.http_endpoint(),g=this.http_param();g.method="findOne",a&&(g.condition=a),b&&(g.options=b);var h={method:"POST",url:f,json:g};this.ajax(h,d)}function f(a,b,c){"function"!=typeof b||c||(c=b,b=null),b=b||{};var d=this.http_endpoint(),e=this.http_param();e.method="count",a&&(e.condition=a),b&&(e.options=b);var f={method:"POST",url:d,json:e};this.ajax(f,l("count",c))}function g(a,b){var c=this.http_endpoint();this.wrap&&(a=this.wrap(a));var d=this.http_param();d.method="insert",d.content=a;var e={method:"POST",url:c,json:d};this.ajax(e,l("success",b))}function h(a,b){var c=this.http_endpoint();this.wrap&&(a=this.wrap(a));var d=this.http_param();d.method="save",d.content=a;var e={method:"POST",url:c,json:d};this.ajax(e,l("success",b))}function i(a,b,c){var d=this.http_endpoint(),e=this.http_param();e.method="remove",a&&(e.condition=a),b&&(e.options=b);var f={method:"POST",url:d,json:e};this.ajax(f,l("success",c))}function j(a,b,c,d){var e=this.http_endpoint(),f=this.http_param();f.method="update",a&&(f.condition=a),f.update=b,c&&(f.options=c);var g={method:"POST",url:e,json:f};this.ajax(g,l("success",d))}function k(a,b,c,d,e){var f=this.http_endpoint(),g=this.http_param();g.method="findAndModify",a&&(g.condition=a),b&&(g.sort=b),g.update=c,d&&(g.options=d);var h={method:"POST",url:f,json:g};this.ajax(h,l("success",e))}function l(a,b){return b?function(c,d){c?b(c):a?"object"!=typeof d?b():b(null,d[a]):b(null,d)}:void 0}function m(){}var n=(a("../core/base"),a("../core/utils"),a("../core/cursor_bulk"));b.exports=function(){var a={};return a.find=c,a.findOne=e,a.count=f,a.insert=g,a.save=h,a.remove=i,a.update=j,a.findAndModify=k,a}},{"../core/base":5,"../core/cursor_bulk":7,"../core/utils":11}],19:[function(a,b){b.exports=function(){return{init:function(){return this}}}},{}],20:[function(a,b){b.exports=function(a){function b(){var b,c,d={};for(b in this)"_"!=b.substr(0,1)&&"get"!=b&&"set"!=b&&(c=this[b],"function"==typeof c&&(d[b]=c));for(b in d)this[b]=a(b,d[b]);return null}return b}},{}],21:[function(a,b){var c=a("../core/utils");b.exports=function(a){function b(){var b=this.unwrap;this.model=function(b){return 1==arguments.length?(this._model=b,this.set("model",b),b):(b=this._model,b||null===b||(b=this._model=this.get("model")||a||null),b)},this.unwrap=function(a){var d=this._model||this.model();return b&&(a=b.call(this,a)),d&&(a=c.bless(a,d)),a}}return b}},{"../core/utils":11}],22:[function(a,b){b.exports=function(){return{noop:function(){return this}}}},{}],23:[function(a,b){var c=a("obop");b.exports=function(){function a(){return a._?a._:(a._=new c,a._)}return{obop:a}}},{obop:36}],24:[function(a,b){function c(){throw new Error("method not implemented: read")}function d(){throw new Error("method not implemented: write")}b.exports=function(a){function b(){var b=this.read||c,e=this.write||d;this.pkey=function(b){return 1==arguments.length?(this._pkey=b,this.set("primary_key",b),b):(b=this._pkey,b||null===b||(b=this._pkey=this.get("primary_key")||a||null),b)},this.read=function(a,c){function d(b,d){b||"object"!=typeof d||(d[e]=a),c(b,d)}var e=this.pkey(),f=e?d:c;b.call(this,a,f)},this.write=function(a,b,c){var d=this.pkey();d&&"object"==typeof b&&(b[d]=a),e.call(this,a,b,c)}}return b}},{}],25:[function(a,b){function c(a){return function(){throw new Error("method not implemented: "+a)}}b.exports=function(a){return a=a||{},function(){for(var b in a)if(!this[b]){var d=a[b];this[b]="function"==typeof d?d:c(b)}}}},{}],26:[function(a,b){function c(a,b,c){return"function"!=typeof b||c||(c=b,b=null),b=b||{},c=c||d,this.find(a,null,b).count(c),this}function d(){}b.exports=function(){var a={};return a.count=c,a}},{}],27:[function(a,b){function c(a,b,c){c=c||{},c.fields&&(b=c.fields);var e=new d(this,a,b);return c.sort&&e.sort(c.sort),c.skip&&e.offset(c.skip),c.limit&&e.limit(c.limit),e}var d=a("../core/cursor");b.exports=function(){var a={};return a.find=c,a}},{"../core/cursor":6}],28:[function(a,b){function c(a,b,c,e,f){function g(a,b){if(a)return f(a);if(!b)return f();var d=b[i];c&&(b=c(b)),h.write(d,b,f)}var h=this,i=this.pkey();if("function"!=typeof e||f||(f=e,e=null),c=this.obop().update(c),e=e||{},e.limit=1,e.sort=b,f=f||d,!i)throw new Error("primary key not defined");return this.findOne(a,e,g),this}function d(){}b.exports=function(){var a={};return a.findAndModify=c,a}},{}],29:[function(a,b){function c(a,b,c){"function"!=typeof b||c||(c=b,b=null),b=b||{},c=c||d;this.find(a,null,b).limit(1).toArray(function(a,b){if(a)c(a);else if(b&&b.length){var d=b[0];c(null,d)}else c()});return this}function d(){}b.exports=function(){var a={};return a.findOne=c,a}},{}],30:[function(a,b){function c(a,b){function c(a,b){var c=a[j];if("undefined"==typeof c||null===c)a[j]=k(),b();else if(l[c]){var d=new Error("duplicated item ID: "+c);b(d)}else l[c]=!0,h.exist(c,function(a,d){!a&&d&&(a=new Error("item already exist: "+c)),b(a)})}function d(a){a?b(a):e.eachSeries(i,g,b)}function g(a,b){var c=a[j];h.write(c,a,b)}var h=this,i=a instanceof Array?a:[a],j=h.pkey();if(!j)throw new Error("primary key not defined");var k=this.get("primary_key_builder")||f,l={};return e.eachSeries(i,c,d),this}function d(a,b){var c=this,d=c.pkey();if(!d)throw new Error("primary key not defined");var e=a[d];return e?c.write(e,a,b):c.insert(a,b),this}var e=a("../core/utils"),f=a("../core/objectid");b.exports=function(){var a={};return a.insert=c,a.save=d,a}},{"../core/objectid":8,"../core/utils":11}],31:[function(a,b){function c(a,b,c){var e;return b=b||{},b.single?(e=d(this,c,c),e&&this.findOne(a,e)):(e=d(this,null,c),e&&this.find(a).each(e)),this}function d(a,b,c){var d=a.pkey();if(!d)throw new Error("primary key not defined");return c=c||e,function(e,f){if(e)return c(e);if(!f)return c();var g=f[d];a.erase(g,b)}}function e(){}b.exports=function(){var a={};return a.remove=c,a}},{}],32:[function(a,b){function c(a,b,c,e){function f(a,c){if(a)return e(a);if(!c)return e();var d=c[i];b&&(c=b(c)),h.write(d,c,g)}var g,h=this,i=this.pkey();if("function"!=typeof c||e||(e=c,c=null),b=this.obop().update(b),c=c||{},e=e||d,!i)throw new Error("primary key not defined");return c.multi?this.find(a).each(f):(g=e,this.findOne(a,f)),this}function d(){}b.exports=function(){var a={};return a.update=c,a}},{}],33:[function(a,b){function c(a,b){function c(a,c){!a&&d.unwrap&&(c=d.unwrap(c)),b(a,c)}b=b||k;var d=this,e=this.http_endpoint()+a,f=this.http_param(),g={method:"GET",url:e};Object.keys(f)&&(g.form=f),this.ajax(g,c)}function d(a,b,c){var d=this.http_endpoint()+a;this.wrap&&(b=this.wrap(b));var e=this.http_param();e.method="write",e.content=b;var f={method:"POST",url:d,json:e};this.ajax(f,h("success",c))}function e(a,b){var c=this.http_endpoint()+a,d=this.http_param();d.method="erase";var e={method:"POST",url:c,form:d};this.ajax(e,h("success",b))}function f(a,b){b=b||k;var c=this.http_endpoint()+a,d=this.http_param();d.method="exist";var e={method:"POST",url:c,form:d};this.ajax(e,h("exist",b))}function g(a){a=a||k;var b=this.http_endpoint(),c=this.http_param();c.method="index";var d={method:"POST",url:b,form:c};this.ajax(d,h("index",a))}function h(a,b){return b?function(c,d){c?b(c):a?"object"!=typeof d?b():b(null,d[a]):b(null,d)}:void 0}function i(a,b){return function(c,d){var e=this.get(a)||{};if(1==arguments.length)return e[c];if(e=l.clone(e),arguments.length>1)return e[c]=d,this.set(a,e),this;if(b)for(c in e)"function"==typeof e[c]&&(e[c]=e[c]());return e}}function j(){var a=this.get("endpoint");if(!a)throw new Error("endpoint not defined");return a.replace(/\/*$/,"/")}function k(){}var l=a("../core/utils"),m=a("../mixin/http_more");b.exports=function(){var a={};return a.read=c,a.write=d,a.erase=e,a.exist=f,a.index=g,a.http_endpoint=j,a.http_param=i("http_param",!0),l.extend(a,m.call(this)),a}},{"../core/utils":11,"../mixin/http_more":18}],34:[function(a,b){function c(){var a=this.get("local_storage");return a=a||f("localStorage")||h}function d(a){var b=this.get("namespace");return a=encodeURIComponent(a),b&&(a=b+":"+a),a}function e(a){var b=this.get("namespace");if(b){b+=":";var c=b.length;if(a.substr(0,c)!=b)return new Error("Invalid ID: "+a);a=a.substr(c)}return a=decodeURIComponent(a)}var f=a("wrequire"),g=a("./memory"),h={};b.exports=function(){var a=g.call(this);return a.memory_store=c,a.escape=d,a.unescape=e,a}},{"./memory":35,wrequire:44}],35:[function(a,b){function c(a,b){b=b||i;var c=this._memory_store||(this._memory_store=this.memory_store());if(a=this.escape(a),c.hasOwnProperty(a)&&this.decode){var d=c[a];this.decode(d,b)}else{var e=new Error("Item not found");b(e,null)}}function d(a,b,c){c=c||i;var d=this._memory_store||(this._memory_store=this.memory_store());a=this.escape(a),this.encode(b,function(b,e){b||(d[a]=e),c(b)})}function e(a,b){b=b||i;var c=this._memory_store||(this._memory_store=this.memory_store());if(a=this.escape(a),c.hasOwnProperty(a))delete c[a],b();else{var d=new Error("Item not found");b(d)}}function f(a,b){b=b||i;var c=this._memory_store||(this._memory_store=this.memory_store());a=this.escape(a);var d=c.hasOwnProperty(a);b(null,d)}function g(a){a=a||i;var b=this._memory_store||(this._memory_store=this.memory_store()),c=Object.keys(b),d=this.unescape.bind(this);c=c.map(d),c=c.filter(function(a){return!(a instanceof Error)}),a(null,c)}function h(){var a,b=this.get("namespace");return a=b?j[b]||(j[b]={}):{}}function i(){}b.exports=function(){var a={};return a.read=c,a.write=d,a.erase=e,a.exist=f,a.index=g,a.memory_store=h,a};var j={}},{}],36:[function(a,b){function c(){return this instanceof c?void 0:new c}var d=a("./lib/dollar_where"),e=a("./lib/dollar_update");c.where=c.prototype.where=a("./lib/where.js").where,c.view=c.prototype.view=a("./lib/view.js").view,c.order=c.prototype.order=a("./lib/order.js").order,c.update=c.prototype.update=a("./lib/update.js").update,c.system=c.prototype.system=a("./lib/system.json"),c.$where=c.prototype.$where=new d,c.$update=c.prototype.$update=new e,b.exports=c},{"./lib/dollar_update":37,"./lib/dollar_where":38,"./lib/order.js":39,"./lib/system.json":40,"./lib/update.js":41,"./lib/view.js":42,"./lib/where.js":43}],37:[function(a,b){function c(){return this instanceof c?void 0:new c}b.exports=c,c.prototype={$set:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a)b[c]=a[c];return b}},$unset:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a)delete b[c];return b}},$rename:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a){var d=b[c];if("undefined"!=typeof d){delete b[c];var e=a[c];b[e]=d}}return b}},$push:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a){var d=a[c],e=b[c];e instanceof Array||(b[c]="undefined"==typeof e?[]:[e]),b[c].push(d)}return b}},$pull:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a){var d=a[c],e=b[c];if(e instanceof Array){for(var f=[],g=e.length,h=0;g>h;h++){var i=e[h];d!=i&&f.push(i)}b[c]=f}else d==e&&(b[c]=[])}return b}},$inc:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a){var d=a[c],e=b[c];d=parseFloat(d)||0,e=parseFloat(e)||0,b[c]=e+d}return b}}}},{}],38:[function(a,b){function c(){return this instanceof c?void 0:new c}function d(a){for(var b=a.length,c=0;b>c;c++){var d=a[c];if(d instanceof Error)return d}}function e(a){var b=a.length;return d(a)||function(c){for(var d=0;b>d;d++){var e=a[d];if(!e(c))return!1}return!0}}function f(a){var b=a.length;return d(a)||function(c){for(var d=0;b>d;d++){var e=a[d];if(e(c))return!0}return!1}}b.exports=c,c.prototype={$gt:function(a){return function(b){return b>a}},$gte:function(a){return function(b){return b>=a}},$in:function(a){if(!(a instanceof Array))return new Error("invalid query");var b=a.length;return function(c){for(var d=0;b>d;d++)if(c==a[d])return!0;return!1}},$lt:function(a){return function(b){return a>b}},$lte:function(a){return function(b){return a>=b}},$ne:function(a){return function(b){return b!=a}},$nin:function(a){var b=a.length;return function(c){for(var d=0;b>d;d++)if(c==a[d])return!1;return!0}},$or:function(a,b){if(a){if(!(a instanceof Array)||0===a.length)return new Error("$or requires nonempty array");var c=[];return a.forEach(function(a){var d=b.where(a);c.push(d)}),f(c)}},$and:function(a,b){if(a){if(!(a instanceof Array)||0===a.length)return new Error("$and expression must be a nonempty array");var c=[];return a.forEach(function(a){var d=b.where(a);c.push(d)}),e(c)}},$not:function(a,b){var c=b.where(a);return function(a){return!c(a)}},$exists:function(a){return function(b){var c="undefined"!=typeof b;return c===a}},$size:function(a){return function(b){var c,d="undefined"!=typeof b;return d?b instanceof Array?(c=b.length,c==a):!1:!1}}}},{}],39:[function(a,b,c){function d(a){function b(a,b,d){function e(c,e){var f=c[a],g=e[a];return f>g?b:g>f?-b:f!==l&&g===l?b:f===l&&g!==l?-b:d?d(c,e):0}function f(a,b){var c=a[g],e=b[g],f=c&&"object"==typeof c,h=e&&"object"==typeof e;if(f||h){f||(c={}),h||(e={});var i=j(c,e);if(i)return i}return d?d(a,b):0}var g,h,i,j,k=a.indexOf(".");return k>-1?(g=a.substr(0,k),h=a.substr(k+1),i=[h,b],j=c.order([i]),f):e;var l}var c=this,d=null;if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)return new Error("Invalid order operator type: "+a);if(a instanceof Array){var e;if(a.forEach(function(a){e||a instanceof Array&&2===a.length&&"undefined"!=typeof a[0]&&a[1]-a[1]===0||(e=new Error("Invalid order pair: "+a))}),e)return e}else{var f=[];for(var g in a){var h=[g,a[g]];f.push(h)}a=f}var i=a.length;if(0===i)return d;for(var j,k=i-1;k>=0;k--)j=b(a[k][0],a[k][1],j);return j}c.order=function(a,b){var c,e=arguments.length;if(1==e){if(c=d.call(this,a),c instanceof Error)throw c;return c}if(2==e){if(a instanceof Array){if(c=d.call(this,b),c instanceof Error)throw c;return a.sort(c)}throw new Error("Invalid argument type: "+a)
}throw new Error("Invalid arguments length: "+e)}},{}],40:[function(a,b){b.exports={name:"obop",version:"0.0.10"}},{}],41:[function(a,b,c){function d(a){var b,c=this,f=null;if("function"==typeof a)return a;if(a=a||{},!Object.keys(a))return f;if("object"!=typeof a)return new Error("Invalid update operator type: "+d);var g=[];return Object.keys(a).forEach(function(d){if(!b){var e=c.$update[d];if(!e)return void(b=new Error("Unknown update operator: "+d));var f=a[d],h={},i={};for(var j in f){var k=f[j],l=j.indexOf(".");if(l>-1){var m=j.substr(0,l),n=j.substr(l+1);i[m]=i[m]||{},i[m][n]=k}else h[j]=k}if(Object.keys(h).length){var o=e(h);g.push(o)}Object.keys(i).length&&Object.keys(i).forEach(function(a){var b={};b[d]=i[a];var e=c.update(b),f=function(b){var c=b[a];return"object"!=typeof c&&(c=b[a]={}),b[a]=e(c),b};g.push(f)})}}),b?b:g.length<2?g.shift()||f:e(g)}function e(a){var b=a.length;return function(c){for(var d=0;b>d;d++){var e=a[d];c=e(c)}return c}}c.update=function(a,b){var c,e=arguments.length;if(1==e){if(c=d.call(this,a),c instanceof Error)throw c;return c}if(2==e){if(a instanceof Array){if(c=d.call(this,b),c instanceof Error)throw c;return a.map(c)}throw new Error("Invalid argument type: "+a)}throw new Error("Invalid arguments length: "+e)}},{}],42:[function(a,b,c){function d(a){function b(a){var b={};return a.hasOwnProperty(l)&&(b[l]=a[l]),b}function c(a){var b={};return Object.keys(a).forEach(function(c){n[c]||(b[c]=a[c])}),b}function d(a){var b={};return Object.keys(a).forEach(function(c){m[c]&&(b[c]=a[c])}),b}function e(a){var b={};return Object.keys(a).forEach(function(c){var d=n[c],e=a[c];"function"==typeof d?b[c]="object"==typeof e?d(e):e:d||(b[c]=e)}),b}function f(a){var b={};return Object.keys(a).forEach(function(c){var d=m[c],e=a[c];"function"==typeof d?"object"==typeof e&&(b[c]=d(e)):d&&(b[c]=e)}),b}function g(a){return v&&(a=f(a)),w&&(a=e(a)),a}var h=this,i=null;if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)return new Error("Invalid view parameters type: "+a);var j=Object.keys(a);if(!j.length)return i;var k,l=j[0],m={},n={},o={},p={};for(var q in a){var r=a[q],s=q.indexOf(".");if(s>-1){var t=q.substr(0,s),u=q.substr(s+1);k=!0,r?(o[t]=o[t]||{},o[t][u]=r):(p[t]=p[t]||{},p[t][u]=r)}else r?m[q]=!0:n[q]=!0}k&&(Object.keys(o).forEach(function(a){var b=o[a];m[a]=h.view(b)}),Object.keys(p).forEach(function(a){var b=p[a];n[a]=h.view(b)}));var v=Object.keys(m).length,w=Object.keys(n).length;return 1!==v||w||k?v&&!w?k?f:d:!v&&w?k?e:c:g:b}c.view=function(a,b){var c,e=arguments.length;if(1==e){if(c=d.call(this,a),c instanceof Error)throw c;return c}if(2==e){if(a instanceof Array){if(c=d.call(this,b),c instanceof Error)throw c;return a.map(c)}throw new Error("Invalid argument type: "+a)}throw new Error("Invalid arguments length: "+e)}},{}],43:[function(a,b,c){function d(a){function b(a){Object.keys(a).forEach(function(b){if(!v){var d=a[b],f=c.where(d);if(f){if(f instanceof Error)return void(v=f);var g=function(a){return f(a[b])};g&&e.push(g)}}})}var c=this,d=null;if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)return new Error("Invalid where operator type: "+a);var e=[],g={},h={},i={};for(var j in a){var k=a[j],l=j.indexOf("."),m=c.$where[j];if(m){var n=m(k,c,j);n&&e.push(n)}else if(l>-1){var o=j.substr(0,l),p=j.substr(l+1);h[o]=h[o]||{},h[o][p]=k}else{if(k instanceof Array)return new Error("Unknown where operator: "+j);"object"==typeof k?i[j]=k:g[j]=k}}var q=Object.keys(g);if(1==q.length){var r=q[0],s=a[r],t=function(a){return"object"==typeof a&&a[r]==s};e.push(t)}else if(q.length>1){var u=function(a){if("object"!=typeof a)return!1;for(var b in g)if(a[b]!=g[b])return!1;return!0};e.push(u)}var v;return b(h),b(i),v?new Error(v):e.length<2?e.shift()||d:f(e)}function e(a){for(var b=a.length,c=0;b>c;c++){var d=a[c];if(d instanceof Error)return d}}function f(a){var b=a.length;return e(a)||function(c){for(var d=0;b>d;d++){var e=a[d];if(!e(c))return!1}return!0}}c.where=function(a,b){var c,e=arguments.length;if(1==e){if(c=d.call(this,a),c instanceof Error)throw c;return c}if(2==e){if(a instanceof Array){if(c=d.call(this,b),c instanceof Error)throw c;return a.filter(c)}throw new Error("Invalid argument type: "+a)}throw new Error("Invalid arguments length: "+e)}},{}],44:[function(a,b){function c(b,c){return"undefined"!=typeof window&&"undefined"!=typeof window[b]?window[b]:"undefined"!=typeof a&&"undefined"!=typeof c?a(c):void 0}b.exports=c},{}]},{},[1])(1)});