!function(a){if("function"==typeof bootstrap)bootstrap("kagodb",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeKagoDB=a}else"undefined"!=typeof window?window.KagoDB=a():global.KagoDB=a()}(function(){return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b){var c=a("./common"),d=c.inherit();d.bundle.utils=a("../core/utils"),d.bundle.objectid=a("../core/objectid"),d.bundle.system=a("../core/system"),d.bundle.deny=a("../mixin/deny"),d.bundle.memory=a("../storage/memory"),d.bundle.http_jquery=a("../storage/http_jquery"),d.bundle.http_superagent=a("../storage/http_superagent"),d.bundle.local_storage=a("../storage/local_storage"),b.exports=d},{"./common":2,"../core/utils":3,"../core/objectid":4,"../core/system":5,"../mixin/deny":6,"../storage/memory":7,"../storage/http_jquery":8,"../storage/http_superagent":9,"../storage/local_storage":10}],4:[function(a,b){function c(a){if(!(this instanceof c))return new c(a);var b;if(a instanceof c?b=a.$oid:"object"==typeof a&&a&&a.$oid?b=a.$oid:"string"==typeof a&&(b=a),b){if(24==b.length)this.$oid=b;else if(12==b.length)this.$oid=d(b);else if(b.length>0)throw new Error("Invalid source ObjectID: "+a)}else this.$oid=e(a)}function d(a){for(var b=[],c=a.length,d=0;c>d;d++){var e=a.charCodeAt(d),f=e.toString(16);1==f.length&&(f="0"+f),b.push(f)}return b.join("")}function e(a){var b=a instanceof Date?a:new Date,d=Math.floor(b.getTime()/1e3),e=c._machineId||(c._machineId=Math.floor(16777216*Math.random())),f=c._processId||(c._processId=Math.floor(65536*Math.random()));c._globalSeq||(c._globalSeq=0);var g=++c._globalSeq,h=("00000000"+d.toString(16)).substr(-8,8),i=("000000"+e.toString(16)).substr(-6,6),j=("0000"+f.toString(16)).substr(-4,4),k=("000000"+g.toString(16)).substr(-6,6),l=[h,i,j,k];return l.join("")}b.exports=c,c.prototype={getGenerationTime:function(){return parseInt(this.$oid.substr(0,8),16)},setGenerationTime:function(a){var b=("00000000"+a.toString(16)).substr(-8,8),c=this.$oid.substr(8),d=[b,c];this.$oid=d.join("")},toHexString:function(){return this.$oid},getTimestamp:function(){var a=parseInt(this.$oid.substr(0,8),16);return new Date(1e3*a)},equals:function(a){return this+""==a},toOctets:function(){for(var a=this.toHexString(),b=[],c=a.length,d=0;c>d;d+=2){var e=a.substr(d,2),f=parseInt(e,16);b.push(f)}return String.fromCharCode.apply(null,b)}},c.prototype.valueOf=c.prototype.toHexString,c.prototype.toString=c.prototype.toHexString,c.prototype.toJSON=c.prototype.toHexString,c.createFromTime=function(a){a=Math.floor(a)||0;var b=("00000000"+a.toString(16)).substr(-8,8),d="000000",e="0000",f="000000",g=[b,d,e,f],h=g.join("");return new c(h)},c.createFromHexString=function(a){return new c(a)}},{}],3:[function(a,b,c){function d(){}c.inherits=function(a,b){b=b||function(){},a=a||function(){b.apply(this,arguments)};var c=function(){};return c.prototype=b.prototype,a.prototype=new c,a.prototype.__super__=b,a},c.eachSeries=function(a,b,c){function e(a){if(a)c(a);else if(f.length){var d=f.shift();b(d,e)}else c()}b=b||d,c=c||d;var f=[].concat(a);e()},c.extend=function(a,b){b=b||{};for(var c in b)a[c]=b[c];return a},c.clone=function(a){var b={};for(var c in a)b[c]=a[c];return b},c.bless=function(a,b){if(b&&"object"==typeof a){if(a.__proto__)a.__proto__=b.prototype;else{var c=new b;for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);a=c}return a}}},{}],6:[function(a,b){b.exports=function(a,b){function c(a,c){var d,e=b||new Error("method denied: "+a);return c=parseInt(c,10),d=c>=0?function(){var a=arguments[c];if("function"!=typeof a)throw e;a(e)}:0>c?function(){var a=arguments[arguments.length+c];if("function"!=typeof a)throw e;a(e)}:function(){throw e}}var d={};for(var e in a)d[e]=c(e,a[e]);return d}},{}],7:[function(a,b){!function(){function a(a,b){b=b||h;var c=this._memory_store||(this._memory_store=this.memory_store()),d=this._memory_serialize||(this._memory_serialize=this.get("memory_serialize")?1:-1);if(d>0&&this.escape&&(a=this.escape(a)),c.hasOwnProperty(a)&&this.decode){var e=c[a];d>0?this.decode(e,b):b(null,e)}else{var f=new Error("Item not found");b(f,null)}}function c(a,b,c){c=c||h;var d=this._memory_store||(this._memory_store=this.memory_store()),e=this._memory_serialize||(this._memory_serialize=this.get("memory_serialize")?1:-1);e>0&&this.escape&&(a=this.escape(a)),e>0&&this.encode?this.encode(b,function(b,e){b||(d[a]=e),c(b)}):(d[a]=b,c())}function d(a,b){b=b||h;var c=this._memory_store||(this._memory_store=this.memory_store()),d=this._memory_serialize||(this._memory_serialize=this.get("memory_serialize")?1:-1);if(d>0&&this.escape&&(a=this.escape(a)),c.hasOwnProperty(a))delete c[a],b();else{var e=new Error("Item not found");b(e)}}function e(a,b){b=b||h;var c=this._memory_store||(this._memory_store=this.memory_store()),d=this._memory_serialize||(this._memory_serialize=this.get("memory_serialize")?1:-1);d>0&&this.escape&&(a=this.escape(a));var e=c.hasOwnProperty(a);b(null,e)}function f(a){a=a||h;var b=this._memory_store||(this._memory_store=this.memory_store()),c=this._memory_serialize||(this._memory_serialize=this.get("memory_serialize")?1:-1),d=Object.keys(b);if(c>0&&this.unescape){var e=this.unescape.bind(this);d=d.map(e),d=d.filter(function(a){return!(a instanceof Error)})}a(null,d)}function g(){var a,b=this.get("namespace");return a=b?i[b]||(i[b]={}):{}}function h(){}b.exports=function(){var b={};return b.read=a,b.write=c,b.erase=d,b.exist=e,b.index=f,b.memory_store=g,b};var i={}}()},{}],5:[function(a,b,c){c.version=function(){var b=a("../package.json"),c=b.name,d=b.version;return c+" "+d}},{"../package.json":11}],2:[function(a,b){var c=a("../core/base"),d=a("../mixin/storage"),e=a("../mixin/find"),f=a("../mixin/pkey"),g=a("../mixin/events"),h=a("../mixin/model"),i=a("../mixin/noop"),j=a("../mixin/update"),k=a("../mixin/remove"),l=a("../mixin/insert"),m=a("../mixin/encode"),n=a("../mixin/stub"),o=c.inherit();o.mixin(i()),o.mixin(n()),o.mixin(m()),o.mixin(e()),o.mixin(l()),o.mixin(j()),o.mixin(k()),o.mixin(d()),o.mixin(g()),o.mixin(f()),o.mixin(h()),b.exports=o},{"../core/base":12,"../mixin/storage":13,"../mixin/find":14,"../mixin/pkey":15,"../mixin/events":16,"../mixin/model":17,"../mixin/noop":18,"../mixin/update":19,"../mixin/remove":20,"../mixin/insert":21,"../mixin/encode":22,"../mixin/stub":23}],8:[function(a,b){var c=a("../storage/http_base"),d=a("../mixin/request_jquery"),e=a("../core/utils");b.exports=function(){var a=c.call(this),b=d.call(this),f={};return e.extend(f,a),e.extend(f,b),f}},{"../storage/http_base":24,"../mixin/request_jquery":25,"../core/utils":3}],9:[function(a,b){var c=a("../storage/http_base"),d=a("../mixin/request_superagent"),e=a("../core/utils");b.exports=function(){var a=c.call(this),b=d.call(this),f={};return e.extend(f,a),e.extend(f,b),f}},{"../storage/http_base":24,"../mixin/request_superagent":26,"../core/utils":3}],11:[function(a,b){b.exports={name:"kagodb",version:"0.2.18",homepage:"https://github.com/kawanet/kagodb",description:"Kago Database Engine",repository:{type:"git",url:"https://github.com/kawanet/kagodb.git"},main:"index.js",keywords:["api","database","db","json","mongodb","memory","yaml"],dependencies:{express:"*","js-yaml":"*",request:"*",wrequire:"*",superagent:"*"},devDependencies:{chai:"*",grunt:"*","grunt-mocha-test":"*","grunt-contrib-jshint":"*","grunt-jsdoc":"*","grunt-browserify":"*","grunt-contrib-uglify":"*",async:"*",jquery:"*",supertest:"*",browserify:"*","browserify-shim":"*"}}},{}],15:[function(a,b){function c(){throw new Error("method not implemented: read")}function d(){throw new Error("method not implemented: write")}b.exports=function(a){function b(){var b=this.read||c,e=this.write||d;this.pkey=function(b){return 1==arguments.length?(this._pkey=b,this.set("primary_key",b),b):(b=this._pkey,b||null===b||(b=this._pkey=this.get("primary_key")||a||null),b)},this.read=function(a,c){function d(b,d){b||"object"!=typeof d||(d[e]=a),c(b,d)}var e=this.pkey(),f=e?d:c;b.call(this,a,f)},this.write=function(a,b,c){var d=this.pkey();d&&"object"==typeof b&&(b[d]=a),e.call(this,a,b,c)}}return b}},{}],16:[function(a,b){function c(a,b){var c=this._events||(this._events={}),d=c[a]||(c[a]=[]);d.push(b)}function d(a,b){var c,d=this._events;if(d){if(!a)return delete this._events,void 0;if(c=d[a])return b?(d[a]=c.filter(function(a){return b!=a}),void 0):(delete d[a],void 0)}}function e(a,b){var c=this,d=function(){d.done||(c.off(a,b),b.apply(this,arguments),d.done=!0)};this.on(a,d)}function f(a){var b,c,d=this,e=this._events;e&&(b=e[a],b&&(c=Array.prototype.slice.call(arguments),c.shift(),b.forEach(function(a){a.apply(d,c)})))}b.exports=function(){var a={};return a.on=c,a.off=d,a.once=e,a.emit=f,a}},{}],18:[function(a,b){b.exports=function(){return{noop:function(){return this}}}},{}],20:[function(a,b){function c(a,b,c){var e;return b?(e=d(this,c,c),e&&this.findOne(a,e)):(e=d(this,null,c),e&&this.find(a).each(e)),this}function d(a,b,c){var d=a.pkey();if(!d)throw new Error("primary key not defined");return c=c||e,function(e,f){if(e)return c(e);if(!f)return c();var g=f[d];a.erase(g,b)}}function e(){}b.exports=function(){var a={};return a.remove=c,a}},{}],23:[function(a,b){function c(a){return function(){throw new Error("method not implemented: "+a)}}b.exports=function(a){a=a||{read:1,write:1,erase:1,exist:1,index:1,find:1,findOne:1,count:1,insert:1,save:1,update:1,findAndModify:1,remove:1};var b={};for(var d in a)b[d]=c(d);return b}},{}],22:[function(a,b){function c(a,b){var c;try{c=JSON.parse(a)}catch(d){return b(d),void 0}b(null,c)}function d(a,b){var c,d=this.get("json_replacer"),e=this.get("json_spaces");try{c=JSON.stringify(a,d,e)}catch(f){b(f)}b(null,c)}b.exports=function(){var a={};return a.decode=c,a.encode=d,a.escape=encodeURIComponent,a.unescape=decodeURIComponent,a}},{}],12:[function(a,b){function c(a){function b(a){return this instanceof b?(this.set(b.settings),this.set(a),void 0):new b(a)}return f.inherits(b,a),b.settings=f.clone(a.settings),b.prototype.bundle=b.bundle=f.clone(a.bundle||{}),b.mixin=function(a){return e(b.prototype,a),b},b.inherit=function(){return c(b)},b.get=function(a){var c=b.settings||(b.settings={});return c[a]},b.set=function(a,c){var d=b.settings||(b.settings={});return d[a]=c,b},b}function d(){}function e(a,b){if("function"==typeof b)b=b.call(a),b&&e(a,b);else{if("object"!=typeof b)throw new Error("invalid mixin("+b+")");for(var c in b)a[c]=b[c]}}var f=a("./utils");d.prototype.get=function(a){var b=this.settings||(this.settings={});return b[a]},d.prototype.set=function(a,b){var c=this.settings||(this.settings={}),d=arguments.length;if(2==d&&a)c[a]=b;else if(1==d&&"object"==typeof a){var e=a;for(a in e)c[a]=e[a]}else if(d>1||"undefined"!=typeof a)throw new Error("invalid set("+a+", "+b+")");return this},d.prototype.mixin=function(a){return e(this,a),this},b.exports=c(d)},{"./utils":3}],13:[function(a,b){var c=a("../mixin/dynamic_mixin");b.exports=function(){function a(){return c.call(this,"storage")}return a}},{"../mixin/dynamic_mixin":27}],14:[function(a,b){function c(a,b){return new g(this,a,b)}function d(a,b){return b=b||f,this.find(a).limit(1).toArray(function(a,c){if(a)b(a);else if(c&&c.length){var d=c[0];b(null,d)}else b()}),this}function e(a,b){b=b||f;var c=this.find(a);return c.count(b),this}function f(){}var g=a("../core/cursor");b.exports=function(){var a={};return a.find=c,a.findOne=d,a.count=e,a}},{"../core/cursor":28}],17:[function(a,b){function c(){throw new Error("method not implemented: read")}var d=a("../core/utils");b.exports=function(a){function b(){var b=this.read||c;this.model=function(b){return 1==arguments.length?(this._model=b,this.set("model",b),b):(b=this._model,b||null===b||(b=this._model=this.get("model")||a||null),b)},this.read=function(a,c){function e(a,b){a||"object"!=typeof b||(b=d.bless(b,f)),c(a,b)}var f=this._model||this.model(),g=f?e:c;b.call(this,a,g)}}return b}},{"../core/utils":3}],19:[function(a,b){function c(a,b,c,d){var f;return c=c||{},c.multi?(f=e(this,b,null,d),f&&this.find(a).each(f)):(f=e(this,b,d,d),f&&this.findOne(a,f)),this}function d(a,b,c,d,f){this.pkey();var g=e(this,c,f,f);return g&&this.find(a).sort(b).nextObject(g),this}function e(a,b,c,d){var e=a.pkey();if(b=h.parser(b)||f,d=d||g,!e)throw new Error("primary key not defined");return function(f,g){if(f)return d(f);if(!g)return d();var h=g[e];g=b(g),a.write(h,g,c)}}function f(a){return a}function g(){}var h=a("../core/update_op");b.exports=function(){var a={};return a.update=c,a.findAndModify=d,a}},{"../core/update_op":29}],21:[function(a,b){function c(a,b){function c(a,b){var c=a[j];if("undefined"==typeof c||null===c)a[j]=new f,b();else if(k[c]){var d=new Error("duplicated item ID: "+c);b(d)}else k[c]=!0,h.exist(c,function(a,d){!a&&d&&(a=new Error("item already exist: "+c)),b(a)})}function d(a){a?b(a):e.eachSeries(i,g,b)}function g(a,b){var c=a[j];h.write(c,a,b)}var h=this,i=a instanceof Array?a:[a],j=h.pkey();if(!j)throw new Error("primary key not defined");var k={};return e.eachSeries(i,c,d),this}function d(a,b){var c=this,d=c.pkey();if(!d)throw new Error("primary key not defined");var e=a[d];return e?c.write(e,a,b):c.insert(a,b),this}var e=a("../core/utils"),f=a("../core/objectid");b.exports=function(){var a={};return a.insert=c,a.save=d,a}},{"../core/utils":3,"../core/objectid":4}],24:[function(a,b){function c(a,b){var c=this.http_endpoint()+a,d=this.http_param(),e={method:"GET",url:c};Object.keys(d)&&(e.form=d),this.request(e,h(null,b))}function d(a,b,c){var d=this.http_endpoint()+a,e=this.http_param();e.method="write",e.content=b;var f={method:"POST",url:d,json:e};this.request(f,h("success",c))}function e(a,b){var c=this.http_endpoint()+a,d=this.http_param();d.method="erase";var e={method:"POST",url:c,form:d};this.request(e,h("success",b))}function f(a,b){b=b||l;var c=this.http_endpoint()+a,d=this.http_param();d.method="exist";var e={method:"POST",url:c,form:d};this.request(e,h("exist",b))}function g(a){a=a||l;var b=this.http_endpoint(),c=this.http_param();c.method="index";var d={method:"POST",url:b,form:c};this.request(d,h("index",a))}function h(a,b){return b?function(c,d){c?b(c):a?"object"!=typeof d?b():b(null,d[a]):b(null,d)}:void 0}function i(){var a=this.get("http_param")||{},b=m.clone(a);for(var c in b)"function"==typeof b[c]&&(b[c]=b[c]());return b}function j(){var a=this.get("endpoint");if(!a)throw new Error("endpoint not defined");return a.replace(/\/*$/,"/")}function k(){throw new Error("request() not implemented")}function l(){}var m=a("../core/utils"),n=a("../storage/http_more"),o=a("../mixin/http_find");b.exports=function(){var a={};return a.read=c,a.write=d,a.erase=e,a.exist=f,a.index=g,a.request=k,a.http_endpoint=j,a.http_param=i,m.extend(a,o.call(this)),m.extend(a,n.call(this)),a}},{"../core/utils":3,"../storage/http_more":30,"../mixin/http_find":31}],10:[function(a,b){function c(){this._memory_serialize=1;var a=this.get("local_storage");return a=a||f("localStorage")||h}function d(a){var b=this.get("namespace");return a=encodeURIComponent(a),b&&(a=b+":"+a),a}function e(a){var b=this.get("namespace");if(b){b+=":";var c=b.length;if(a.substr(0,c)!=b)return new Error("Invalid ID: "+a);a=a.substr(c)}return a=decodeURIComponent(a)}var f=a("wrequire"),g=a("./memory"),h={};b.exports=function(){var a=g.call(this);return a.memory_store=c,a.escape=d,a.unescape=e,a}},{"./memory":7,wrequire:32}],29:[function(a,b,c){c.parser=function(a){if("function"==typeof a)return a;if(a=a||{},!Object.keys(a))return null;if("object"!=typeof a)throw new Error("invalid update: "+a);var b={$set:1,$unset:1,$rename:1,$push:1,$pull:1,$inc:1};for(var c in a)if(!b[c]||"object"!=typeof a[c])throw new Error("invalid update operator: "+c);return function(b){var c,d,e;if(!b)return b;if(a.$set)for(c in a.$set)b[c]=a.$set[c];if(a.$unset)for(c in a.$unset)delete b[c];if(a.$rename)for(c in a.$rename)d=a.$rename[c],b[d]=b[c],delete b[c];if(a.$push)for(c in a.$push)e=b[c],e instanceof Array||(b[c]="undefined"==typeof e?[]:[e]),d=a.$push[c],b[c].push(d);if(a.$pull)for(c in a.$pull)if(d=a.$pull[c],e=b[c],e instanceof Array){for(var f=[],g=e.length,h=0;g>h;h++){var i=e[h];d!=i&&f.push(i)}b[c]=f}else d==e&&(b[c]=[]);if(a.$inc)for(c in a.$inc)d=a.$inc[c],e=b[c],d=parseFloat(d)||0,e=parseFloat(e)||0,b[c]=e+d;return b}}},{}],31:[function(a,b){function c(a,b){return new d(this,a,b)}function d(a,b,c){this.collection=a,this._condition=b,this._projection=c}function e(){}b.exports=function(){var a={};return a.find=c,a},d.prototype.toArray=function(a){if(a=a||e,this.cache){var b=[].concat(this.cache);a(b)}else this._toArray(function(b,c){!b&&c&&(this.cache=c,c=[].concat(this.cache)),a(b,c)})},d.prototype._toArray=function(a){var b=this.collection,c=b.http_endpoint(),d=b.http_param();d.method="find",this._condition&&(d.condition=this._condition),this._projection&&(d.projection=this._projection),this._sort&&(d.sort=this._sort),"undefined"!=typeof this._offset&&(d.offset=this._offset),"undefined"!=typeof this._limit&&(d.limit=this._limit);var e={method:"POST",url:c,form:d};b.request(e,function(b,c){b?a(b):a(null,c.data)})},d.prototype.count=function(a){this.toArray(function(b,c){b?a(b):(c=c||[],a(null,c.length))})},d.prototype.sort=function(a){return this._sort=a,this},d.prototype.offset=function(a){return this._offset=a,this},d.prototype.limit=function(a){return this._limit=a,this},d.prototype.each=function(a){function b(d,e){a(d,e),!d&&e&&c.nextObject(b)}var c=this;a=a||e,this.nextObject(b)},d.prototype.nextObject=function(a){var b=this;if(a=a||e,this.list){if(!this.list.length)return a();var c=this.list.shift();a(null,c)}else this.toArray(function(c,d){return c?a(c):(b.list=d||[],b.nextObject(a),void 0)});return this},d.prototype.rewind=function(){delete this.list}},{}],32:[function(a,b){var c;try{c=window}catch(d){}c=c||{},b.exports=function(b,d){return c[b]||d&&a(d)}},{}],27:[function(a,b){function c(a){var b=this.get(a);if(!b)throw new Error(a+" not specified");var c=b+"";if("function"!=typeof b){var d=this.bundle||{};if(b=d[c],!b)throw new Error("invalid "+a+" class: "+c)}for(;"function"==typeof b;)b=b.call(this);for(var e in b)this[e]||(this[e]=b[e]);return b}var d=a("../mixin/intercept_mixin");b.exports=function(a){function b(){return d.call(this,e)}function e(b,d){return function(){var e=this[f]||(this[f]=c.call(this,a)||{}),g=e[b]||d;return g.apply(this,arguments)}}var f="_"+a+"_dynamic_mixin";return b}},{"../mixin/intercept_mixin":33}],28:[function(a,b){function c(){}function d(a,b,c){this.collection=a,this.source=new e(this.collection),this._source=this.source,b&&(b=o.parser(b),b&&(this.source=new f(this.source,b))),c&&(c=p.parser(c),c&&(this.source=new j(this.source,c)))}function e(a){this.collection=a}function f(a,b){this.source=a,this.condition=b}function g(a,b){if("object"==typeof b){var c=Object.keys(b),d=c.length;this.sorter=function(a,e){for(var f=0;d>f;f++){var g=c[f];if(a[g]<e[g])return-b[g];if(a[g]>e[g])return b[g]}}}else this.sorter=b;this.source=a}function h(a,b){this.source=a,this.offset=b}function i(a,b){this.source=a,this.limit=b,this.rest=this.limit}function j(a,b){this.source=a,this.projection=b}function k(a,b){function c(e,f){return e?(b(e),void 0):f?(d.push(f),a.nextObject(c),void 0):(b(null,d),void 0)}var d=[];b=b||m,a.nextObject(c)}function l(a){a&&a()}function m(){}var n=a("./utils"),o=a("../core/condition_op"),p=a("../core/projection_op");b.exports=d,c.prototype.nextObject=function(a){if(!this.source)throw new Error("no source");this.source.nextObject(a)},c.prototype.rewind=function(){if(!this.source)throw new Error("no source");return this.source.rewind&&this.source.rewind(),delete this.nextObject,this},n.inherits(d,c),d.prototype.index=function(a){var b=this;if(a=a||m,b._index){var c=[].concat(b._index);a(null,c)}else b.collection.index(function(c,d){c?a(c):(b._index=d,d=[].concat(b._index),a(null,d))});return this},d.prototype.toArray=function(a){var b=this;if(a=a||m,b._toArray){var c=[].concat(b._toArray);a(null,c)}else k(this.source,function(c,d){c?a(c):(b._toArray=d,d=[].concat(b._toArray),a(null,d))});return this},d.prototype.each=function(a){function b(d,e){a(d,e),!d&&e&&c.nextObject(b)}var c=this;a=a||m,this.nextObject(b)},d.prototype.count=function(a){a=a||m;var b=this.source===this._source?this.index:this.toArray;return b.call(this,function(b,c){b?a(b):a(null,c.length)}),this},d.prototype.sort=function(a){return this.source=new g(this.source,a),this},d.prototype.offset=function(a){return this.source=new h(this.source,a),this},d.prototype.limit=function(a){return this.source=new i(this.source,a),this},n.inherits(e,c),e.prototype.nextObject=function(a){var b=this;return a=a||m,this.collection.index(function(c,d){return c?a(c):(b.list=d||[],b.nextObject=b._nextObject,b.nextObject(a),void 0)}),this},e.prototype._nextObject=function(a){if(!this.list.length)return a();var b=this.list.shift();this.collection.read(b,a)},e.prototype.rewind=function(){delete this.nextObject},n.inherits(f,c),f.prototype.nextObject=function(a){function b(f,g){f?a(f):g?e(g)?a(null,g):d.nextObject(b):(c.nextObject=l,a())}var c=this,d=this.source,e=this.condition;if("function"!=typeof e){var f=new Error("invalid condition: "+e);return a(f),void 0}d.nextObject(b)},n.inherits(g,c),g.prototype.nextObject=function(a){var b=this;a=a||m,k(this.source,function(c,d){return c?a(c):(d=d||[],b.list=d.sort(b.sorter),b.nextObject=b._nextObject,b.nextObject(a),void 0)})},g.prototype._nextObject=function(a){a=a||m;var b=this.list.shift();a(null,b)},n.inherits(h,c),h.prototype.nextObject=function(a){function b(c,h){c?a(c):h?--f>0?g.nextObject(b):d():(e.nextObject=l,a())}function d(){e.nextObject=c.prototype.nextObject,e.nextObject(a)}var e=this,f=this.offset,g=this.source;a=a||m,f>0?g.nextObject(b):d()},n.inherits(i,c),i.prototype.nextObject=function(a){var b=this.source;a=a||m,this.rest-->0?b.nextObject(a):(this.nextObject=l,a())},i.prototype.rewind=function(){this.rest=this.limit,c.prototype.rewind.call(this)},n.inherits(j,c),j.prototype.nextObject=function(a){var b=this,c=this.projection;if("function"!=typeof c){var d=new Error("invalid projection: "+c);return a(d),void 0}this.source.nextObject(function(d,e){d?a(d):e?(e=c(e),a(null,e)):(b.nextObject=l,a())})}},{"./utils":3,"../core/condition_op":34,"../core/projection_op":35}],25:[function(a,b){function c(a,b){var c=this,e={},f=this.get("jquery");if(f=f||d("jQuery","jquery"),!f)throw new Error("jQuery not loaded");e.type=a.method||"GET",e.url=a.url,e.dataType="json",a.json?(e.headers={"Content-Type":"application/json"},e.data=JSON.stringify(a.json)):a.form&&(e.data=a.form),c.emit&&c.emit("request",e),f.ajax(e).fail(function(a,d,e){c.emit&&c.emit("response",a),e instanceof Error||(a=a||{},d=a.status||d,e=a.responseText||e||"",e=new Error(d+" "+e)),b(e)}).done(function(a,d,e){c.emit&&c.emit("response",e),b(null,a)})}var d=a("wrequire");b.exports=function(){var a={request:c};return a}},{wrequire:32}],26:[function(a,b){function c(a,b){var c=this,e=a.method||"GET",f=a.url,g=this.get("superagent");if(g=g||d("superagent","superagent"),!g)throw new Error("superagent not loaded");e=e.toLowerCase(),e="delete"==e?"del":e;var h=g[e](f);h.set("Accept","application/json"),a.json?h.type("json").send(a.json):a.form&&("get"==e?h.query(a.form):h.type("form").send(a.form)),c.emit&&c.emit("request",h),h.end(function(a,d){c.emit&&c.emit("response",d),a?b(a,d):(d.ok||(a=new Error(d.status)),b(a,d.body))})}var d=a("wrequire");b.exports=function(){var a={request:c};return a}},{wrequire:32}],30:[function(a,b){function c(a,b){var c=this.http_endpoint(),d=this.http_param();d.method="findOne",d.condition=a;var e={method:"POST",url:c,form:d};this.request(e,j(null,b))}function d(a,b){var c=this.http_endpoint(),d=this.http_param();d.method="count",d.condition=a;var e={method:"POST",url:c,form:d};this.request(e,j("count",b))}function e(a,b){var c=this.http_endpoint(),d=this.http_param();d.method="insert",d.content=a;var e={method:"POST",url:c,form:d};this.request(e,j("success",b))}function f(a,b){var c=this.http_endpoint(),d=this.http_param();d.method="save",d.content=a;var e={method:"POST",url:c,form:d};this.request(e,j("success",b))}function g(a,b,c){var d=this.http_endpoint(),e=this.http_param();e.method="remove",e.condition=a,e.options={multi:b?0:1};var f={method:"POST",url:d,form:e};this.request(f,j("success",c))}function h(a,b,c,d){var e=this.http_endpoint(),f=this.http_param();f.method="update",f.condition=a,f.update=b,f.options=c;var g={method:"POST",url:e,form:f};this.request(g,j("success",d))}function i(a,b,c,d,e){var f=this.http_endpoint(),g=this.http_param();g.method="findAndModify",g.condition=a,g.sort=b,g.update=c,g.options=d;var h={method:"POST",url:f,form:g};this.request(h,j("success",e))}function j(a,b){return b?function(c,d){c?b(c):a?"object"!=typeof d?b():b(null,d[a]):b(null,d)}:void 0}a("../core/base"),b.exports=function(){var a={};return a.findOne=c,a.count=d,a.insert=e,a.save=f,a.remove=g,a.update=h,a.findAndModify=i,a}},{"../core/base":12}],33:[function(a,b){b.exports=function(a){function b(){var b,c,d=this,e={};for(b in d)"_"!=b.substr(0,1)&&"get"!=b&&"set"!=b&&(c=d[b],"function"==typeof c&&(e[b]=c));for(b in e)d[b]=a(b,e[b])}return b}},{}],34:[function(a,b,c){c.parser=function(a){if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)throw new Error("unknown condition: "+a);var b=Object.keys(a);if(!b.length)return null;if(1==b.length){var c=b[0],d=a[c];if("object"!=typeof d)return function(a){return a[c]==d}}return function(b){for(var c in a)if(b[c]!=a[c])return!1;return!0}}},{}],35:[function(a,b,c){c.parser=function(a){if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)throw new Error("unknown projection: "+a);var b=Object.keys(a);if(!b.length)return null;if(1==b.length){var c=b[0];if(a[c])return function(a){var b={};return b[c]=a[c],b}}return function(b){var c={};for(var d in a)a[d]&&(c[d]=b[d]);return c}}},{}]},{},[1])(1)});