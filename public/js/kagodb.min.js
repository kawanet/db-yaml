!function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a){window.KagoDB=a("./client"),KagoDB.set("jquery",window.jQuery)},{"./client":2}],2:[function(a,b){var c=a("../../core/base"),d=a("../../mixin/storage"),e=a("../../mixin/find"),f=c.inherit();f.mixin(d()),f.mixin(e());var g={memory:a("../../storage/memory"),"http-jquery":a("../../storage/http-jquery")};f.set("storage-preload",g),b.exports=f},{"../../core/base":3,"../../mixin/storage":4,"../../mixin/find":5,"../../storage/memory":6,"../../storage/http-jquery":7}],4:[function(a,b){function c(a,b){return this.storage().read(a,b),this}function d(a,b,c){return this.storage().write(a,b,c),this}function e(a,b){return this.storage().erase(a,b),this}function f(a,b){return this.storage().exist(a,b),this}function g(a){return this.storage().index(a),this}function h(b){if(b&&(this._store=null),!this._store){if(b=b||this.get("storage"),!b)throw new Error("storage not specified");if("function"!=typeof b){b+="";var c=this.get("storage-preload")||{};if(c[b])b=c[b];else{if(b.search(/^[\w\-\.]+$/)<0)throw new Error("invalid store name: "+b);var d=i+"/"+b;try{b=a(d)}catch(e){throw new Error("storage class failed: "+e)}if(!b)throw new Error("storage class invalid: "+b)}}this._store=new b(this.options)}return this._store}var i="../storage";b.exports=function(){var a={};return a.read=c,a.write=d,a.erase=e,a.exist=f,a.index=g,a.storage=h,a}},{}],6:[function(a,b){!function(){function a(b){return this instanceof a?(this.options=b||{},this.options.namespace=this.options.namespace||"default",void 0):new a(b)}function c(a,b){b=b||h;var c=this._store||this.store();if(c.hasOwnProperty(a)){var d=c[a];b(null,d)}else{var e=new Error("Item not found");b(e,null)}}function d(a,b,c){c=c||h;var d=this._store||this.store();d[a]=b,c()}function e(a,b){b=b||h;var c=this._store||this.store();if(c.hasOwnProperty(a))delete c[a],b();else{var d=new Error("Item not found");b(d)}}function f(a,b){b=b||h;var c=this._store||this.store(),d=c.hasOwnProperty(a);b(null,d)}function g(a){a=a||h;var b=this._store||this.store(),c=Object.keys(b);a(null,c)}function h(){}b.exports=a;var i={};a.prototype.read=c,a.prototype.write=d,a.prototype.erase=e,a.prototype.exist=f,a.prototype.index=g,a.prototype.store=function(){var a,b;return this._store||(b=(a=this.options.namespace)?i[a]||(i[a]={}):{},this._store=b),this._store}}()},{}],3:[function(a,b){function c(a){function b(a){return this instanceof b?(this.set(b.options),this.set(a),void 0):new b(a)}return g.inherits(b,a),b.options=d(a.options),b.mixin=function(a){return f(b.prototype,a),b},b.build=function(a){return new b(a)},b.inherit=function(){return c(b)},b.get=function(a){var c=b.options||(b.options={});return c[a]},b.set=function(a,c){var d=b.options||(b.options={});return d[a]=c,b},b}function d(a){var b={};for(var c in a)b[c]=a[c];return b}function e(){}function f(a,b){if("function"==typeof b&&(b=b.call(a)),"object"==typeof b)for(var c in b)a[c]=b[c];else if(!b)throw new Error("invalid mixin("+b+")")}var g=a("./utils");e.prototype.get=function(a){var b=this.options||(this.options={});return b[a]},e.prototype.set=function(a,b){var c=this.options||(this.options={}),d=arguments.length;if(2==d&&a)c[a]=b;else{if(1!=d||"object"!=typeof a)throw new Error("invalid set("+a+", "+b+")");var e=a;for(a in e)c[a]=e[a]}return this},e.prototype.mixin=function(a){return f(this,a),this},b.exports=c(e)},{"./utils":8}],5:[function(a,b){function c(a,b){var c=this.get("condition-parser")||h.parser;if("function"!=typeof c)throw new Error("invalid condition parser: "+c);var d=c(a),e=this.get("projection-parser")||i.parser;if("function"!=typeof e)throw new Error("invalid projection parser: "+e);var f=e(b),j=this.get("cursor")||g;if("function"!=typeof j)throw new Error("invalid cursor class: "+j);return new j(this,d,f)}function d(a,b){return b=b||f,this.find(a).limit(1).toArray(function(a,c){if(a)b(a);else if(c&&c.length){var d=c[0];b(null,d)}else b()}),this}function e(a,b){b=b||f;var c=this.find(a);return c.count(b),this}function f(){}var g=a("../core/cursor"),h=a("../core/condition"),i=a("../core/projection");b.exports=function(){var a={};return a.find=c,a.findOne=d,a.count=e,a}},{"../core/cursor":9,"../core/condition":10,"../core/projection":11}],7:[function(a,b){function c(a){return this instanceof c?(this.options=a||{},void 0):new c(a)}var d=a("../core/utils"),e=a("./http-base");b.exports=d.inherits(c,e),c.prototype.request=function(a,b){var c={};c.type=a.method||"GET",c.url=a.url,c.dataType="json",a.json?(c.headers={"Content-Type":"application/json"},c.data=JSON.stringify(a.json)):a.form&&(c.data=a.form);var d=this.options.jquery;if(!d)throw new Error("jQuery not loaded");d.ajax(c).fail(function(a,c,d){d instanceof Error||(a=a||{},c=a.status||c,d=a.responseText||d||"",d=new Error(c+" "+d)),b(d)}).done(function(a){b(null,a)})}},{"../core/utils":8,"./http-base":12}],8:[function(a,b,c){function d(){}c.inherits=function(a,b){b=b||function(){},a=a||function(){b.apply(this,arguments)};var c=function(){};return c.prototype=b.prototype,a.prototype=new c,a.prototype.__super__=b,a},c.eachSeries=function(a,b,c){function e(a){if(a)c(a);else if(f.length){var d=f.shift();b(d,e)}else c()}b=b||d,c=c||d;var f=[].concat(a);e()}},{}],10:[function(a,b,c){c.parser=function(a){if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)throw new Error("unknown condition: "+a);var b=Object.keys(a);if(!b.length)return null;if(1==b.length){var c=b[0],d=a[c];if("object"!=typeof d)return function(a){return a[c]==d}}return function(b){for(var c in a)if(b[c]!=a[c])return!1;return!0}}},{}],11:[function(a,b,c){c.parser=function(a){if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)throw new Error("unknown projection: "+a);var b=Object.keys(a);if(!b.length)return null;if(1==b.length){var c=b[0];if(a[c])return function(a){var b={};return b[c]=a[c],b}}return function(b){var c={};for(var d in a)a[d]&&(c[d]=b[d]);return c}}},{}],12:[function(a,b){function c(a){return this instanceof c?(this.options=a||{},void 0):new c(a)}function d(a,b){b=b||i;var c=this.endpoint()+a,d={method:"GET",url:c};this.request(d,b)}function e(a,b,c){c=c||i;var d=this.endpoint()+a,e={method:"write",content:b},f={method:"POST",url:d,json:e};this.request(f,c)}function f(a,b){b=b||i;var c=this.endpoint()+a,d={method:"erase"},e={method:"POST",url:c,form:d};this.request(e,b)}function g(a,b){b=b||i;var c=this.endpoint()+a,d={method:"exist"},e={method:"POST",url:c,form:d};this.request(e,function(a,c){c=c||{};var d=!!c.exist;b(a,d)})}function h(a){a=a||i;var b=this.endpoint(),c={method:"index"},d={method:"POST",url:b,form:c};this.request(d,function(b,c){c=c||{},a(b,c.index)})}function i(){}b.exports=c,c.prototype.read=d,c.prototype.write=e,c.prototype.erase=f,c.prototype.exist=g,c.prototype.index=h,c.prototype.endpoint=function(){var a=this.options.endpoint;if(!a)throw new Error("endpoint not defined");return a.replace(/\/*$/,"/")},c.prototype.request=function(){throw new Error("request() not implemented")}},{}],9:[function(a,b){function c(a,b,c){this.collection=a,this.condition=b,this.projection=c,this.filters={}}function d(){}a("./utils"),b.exports=c,c.prototype.index=function(a){var b=this;return a=a||d,b._index?a(null,b._index):b.collection.index(function(c,d){a(c,b._index=d)}),this},c.prototype.toArray=function(a){function b(b){g&&(b=b.sort(g)),h&&(b=b.splice(h)),i&&(b=b.splice(0,i)),c.projection&&(b=b.map(c.projection)),c._values=b,a(null,b)}var c=this;a=a||d;var e=this.condition;if(e&&"function"!=typeof e){var f=new Error("invalid condition: "+e);return a(f),void 0}var g=c.filters.sort,h=c.filters.offset||0,i=c.filters.limit||0,j=h>=0&&i>=1?h+i:0;return c._values?b(c._values):c.index(function(d,f){function g(d,i){if(d)return a(d),void 0;if(i&&(!e||e(i))&&h.push(i),j&&h.length>=j)return b(h),void 0;if(!f.length)return b(h),void 0;var k=f.shift();c.collection.read(k,g)}var h=[];return d?(a(d),void 0):(g(),void 0)}),this},c.prototype.count=function(a){return a=a||d,this.index(function(b,c){b?a(b):a(null,c.length)}),this},c.prototype.sort=function(a){if("object"==typeof a){var b=Object.keys(a),c=b.length,d=function(d,e){for(var f=0;c>f;f++){var g=b[f];if(d[g]<e[g])return-a[g];if(d[g]>e[g])return a[g]}};this.filters.sort=d}else this.filters.sort=a;return this},c.prototype.offset=function(a){return this.filters.offset=a,this},c.prototype.limit=function(a){return this.filters.limit=a,this}},{"./utils":8}]},{},[1]);