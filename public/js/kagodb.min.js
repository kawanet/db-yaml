!function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a){var b=window.KagoDB=a("../../bundle/browser");b.set("jquery",window.jQuery),b.set("local_storage",window.localStorage||{})},{"../../bundle/browser":2}],2:[function(a,b){var c=a("./common"),d={memory:a("../storage/memory"),http_jquery:a("../storage/http_jquery"),local_storage:a("../storage/local_storage")},e=c.inherit();e.set("storage_preload",d),b.exports=e},{"./common":3,"../storage/memory":4,"../storage/http_jquery":5,"../storage/local_storage":6}],3:[function(a,b){var c=a("../core/base"),d=a("../mixin/storage"),e=a("../mixin/find"),f=a("../mixin/version"),g=a("../mixin/pkey"),h=a("../mixin/objectid"),i=a("../mixin/events"),j=a("../core/utils"),k=c.inherit();k.mixin(e()),k.mixin(d()),k.mixin(f()),k.mixin(j()),k.mixin(i()),k.mixin(g()),k.mixin(h()),b.exports=k},{"../core/base":7,"../mixin/storage":8,"../mixin/find":9,"../mixin/version":10,"../mixin/pkey":11,"../mixin/objectid":12,"../mixin/events":13,"../core/utils":14}],4:[function(a,b){!function(){function c(a,b){b=b||i;var c=this._memory_store||(this._memory_store=this.memory_store()),d=this._memory_serialize||(this._memory_serialize=this.get("memory_serialize")?1:-1);if(d>0&&this.escape&&(a=this.escape(a)),c.hasOwnProperty(a)&&this.decode){var e=c[a];d>0?this.decode(e,b):b(null,e)}else{var f=new Error("Item not found");b(f,null)}}function d(a,b,c){c=c||i;var d=this._memory_store||(this._memory_store=this.memory_store()),e=this._memory_serialize||(this._memory_serialize=this.get("memory_serialize")?1:-1);e>0&&this.escape&&(a=this.escape(a)),e>0&&this.encode?this.encode(b,function(b,e){b||(d[a]=e),c(b)}):(d[a]=b,c())}function e(a,b){b=b||i;var c=this._memory_store||(this._memory_store=this.memory_store()),d=this._memory_serialize||(this._memory_serialize=this.get("memory_serialize")?1:-1);if(d>0&&this.escape&&(a=this.escape(a)),c.hasOwnProperty(a))delete c[a],b();else{var e=new Error("Item not found");b(e)}}function f(a,b){b=b||i;var c=this._memory_store||(this._memory_store=this.memory_store()),d=this._memory_serialize||(this._memory_serialize=this.get("memory_serialize")?1:-1);d>0&&this.escape&&(a=this.escape(a));var e=c.hasOwnProperty(a);b(null,e)}function g(a){a=a||i;var b=this._memory_store||(this._memory_store=this.memory_store()),c=this._memory_serialize||(this._memory_serialize=this.get("memory_serialize")?1:-1),d=Object.keys(b);if(c>0&&this.unescape){var e=this.unescape.bind(this);d=d.map(e),d=d.filter(function(a){return!(a instanceof Error)})}a(null,d)}function h(){var a,b=this.get("namespace");return a=b?k[b]||(k[b]={}):{}}function i(){}var j=a("../core/encode");b.exports=function(){var a=j.call(this);return a.read=c,a.write=d,a.erase=e,a.exist=f,a.index=g,a.memory_store=h,a};var k={}}()},{"../core/encode":15}],5:[function(a,b){var c=a("../core/http_base"),d=a("../mixin/request_jquery"),e=a("../core/utils");b.exports=function(){var a=c.call(this),b=d.call(this),f={};return e.extend(f,a),e.extend(f,b),f}},{"../core/http_base":16,"../mixin/request_jquery":17,"../core/utils":14}],6:[function(a,b){function c(){this._memory_serialize=1;var a=this.get("local_storage");if(!a)throw new Error('Please .set("local_storage", window.localStorage || {}) before using this.');return a}function d(a){var b=this.get("namespace");return a=encodeURIComponent(a),b&&(a=b+":"+a),a}function e(a){var b=this.get("namespace");if(b){b+=":";var c=b.length;if(a.substr(0,c)!=b)return new Error("Invalid ID: "+a);a=a.substr(c)}return a=decodeURIComponent(a)}var f=a("./memory");b.exports=function(){var a=f.call(this);return a.memory_store=c,a.escape=d,a.unescape=e,a}},{"./memory":4}],11:[function(a,b){function c(){throw new Error("method not implemented: read")}function d(){throw new Error("method not implemented: write")}b.exports=function(a){function b(){var b=this.read||c,e=this.write||d;this.pkey=function(b){return 1==arguments.length?(this._pkey=b,this.set("primary_key",b),b):(b=this._pkey,b||null===b||(b=this._pkey=this.get("primary_key")||a||null),b)},this.read=function(a,c){function d(b,d){b||"object"!=typeof d||(d[e]=a),c(b,d)}var e=this.pkey(),f=e?d:c;b.call(this,a,f)},this.write=function(a,b,c){var d=this.pkey();d&&"object"==typeof b&&(b[d]=a),e.call(this,a,b,c)}}return b}},{}],12:[function(a,b,c){function d(a){if(!(this instanceof d))return new d(a);var b;if(a instanceof d?b=a.$oid:"object"==typeof a&&a&&a.$oid?b=a.$oid:"string"==typeof a&&(b=a),b){if(24==b.length)this.$oid=b;else if(12==b.length)this.$oid=e(b);else if(b.length>0)throw new Error("Invalid source ObjectID: "+a)}else this.$oid=f(a)}function e(a){for(var b=[],c=a.length,d=0;c>d;d++){var e=a.charCodeAt(d),f=e.toString(16);1==f.length&&(f="0"+f),b.push(f)}return b.join("")}function f(a){var b=a instanceof Date?a:new Date,c=Math.floor(b.getTime()/1e3),e=d._machineId||(d._machineId=Math.floor(16777216*Math.random())),f=d._processId||(d._processId=Math.floor(65536*Math.random()));d._globalSeq||(d._globalSeq=0);var g=++d._globalSeq,h=("00000000"+c.toString(16)).substr(-8,8),i=("000000"+e.toString(16)).substr(-6,6),j=("0000"+f.toString(16)).substr(-4,4),k=("000000"+g.toString(16)).substr(-6,6),l=[h,i,j,k];return l.join("")}var c=b.exports=function(){return{objectId:d}};c.ObjectID=d,d.prototype={getGenerationTime:function(){return parseInt(this.$oid.substr(0,8),16)},setGenerationTime:function(a){var b=("00000000"+a.toString(16)).substr(-8,8),c=this.$oid.substr(8),d=[b,c];this.$oid=d.join("")},toHexString:function(){return this.$oid},getTimestamp:function(){var a=parseInt(this.$oid.substr(0,8),16);return new Date(1e3*a)},equals:function(a){return this+""==a},toOctets:function(){for(var a=this.toHexString(),b=[],c=a.length,d=0;c>d;d+=2){var e=a.substr(d,2),f=parseInt(e,16);b.push(f)}return String.fromCharCode.apply(null,b)}},d.prototype.valueOf=d.prototype.toHexString,d.prototype.toString=d.prototype.toHexString,d.prototype.toJSON=d.prototype.toHexString,d.createFromTime=function(a){a=Math.floor(a)||0;var b=("00000000"+a.toString(16)).substr(-8,8),c="000000",e="0000",f="000000",g=[b,c,e,f],h=g.join("");return new d(h)},d.createFromHexString=function(a){return new d(a)}},{}],13:[function(a,b){function c(a,b){var c=this._events||(this._events={}),d=c[a]||(c[a]=[]);d.push(b)}function d(a,b){var c,d=this._events;if(d){if(!a)return delete this._events,void 0;if(c=d[a])return b?(d[a]=c.filter(function(a){return b!=a}),void 0):(delete d[a],void 0)}}function e(a,b){var c=this,d=function(){d.done||(c.off(a,b),b.apply(this,arguments),d.done=!0)};this.on(a,d)}function f(a){var b,c,d=this,e=this._events;e&&(b=e[a],b&&(c=Array.prototype.slice.call(arguments),c.shift(),b.forEach(function(a){a.apply(d,c)})))}b.exports=function(){var a={};return a.on=c,a.off=d,a.once=e,a.emit=f,a}},{}],14:[function(a,b,c){function d(){}c=b.exports=function(){return{utils:c}},c.inherits=function(a,b){b=b||function(){},a=a||function(){b.apply(this,arguments)};var c=function(){};return c.prototype=b.prototype,a.prototype=new c,a.prototype.__super__=b,a},c.eachSeries=function(a,b,c){function e(a){if(a)c(a);else if(f.length){var d=f.shift();b(d,e)}else c()}b=b||d,c=c||d;var f=[].concat(a);e()},c.extend=function(a,b){b=b||{};for(var c in b)a[c]=b[c];return a},c.clone=function(a){var b={};for(var c in a)b[c]=a[c];return b}},{}],15:[function(a,b){function c(a,b){var c;try{c=JSON.parse(a)}catch(d){return b(d),void 0}b(null,c)}function d(a,b){var c,d=this.get("json_replacer"),e=this.get("json_spaces");try{c=JSON.stringify(a,d,e)}catch(f){b(f)}b(null,c)}b.exports=function(){var a={};return a.decode=c,a.encode=d,a.escape=encodeURIComponent,a.unescape=decodeURIComponent,a}},{}],17:[function(a,b){function c(a,b){var c={};c.type=a.method||"GET",c.url=a.url,c.dataType="json",a.json?(c.headers={"Content-Type":"application/json"},c.data=JSON.stringify(a.json),delete a.json):a.form&&(c.data=a.form,delete a.form);var d=this.get("jquery");if(!d)throw new Error("jQuery not loaded");d.ajax(c).fail(function(a,c,d){d instanceof Error||(a=a||{},c=a.status||c,d=a.responseText||d||"",d=new Error(c+" "+d)),b(d)}).done(function(a,c,d){b(null,a,d)})}b.exports=function(){var a={request:c};return a}},{}],10:[function(a,b){function c(){var b=a("../package.json"),c=b.name,d=b.version;return c+" "+d}b.exports=function(){var a={};return a.version=c,a}},{"../package.json":18}],7:[function(a,b){function c(a){function b(a){return this instanceof b?(this.set(b.settings),this.set(a),void 0):new b(a)}return f.inherits(b,a),b.settings=f.clone(a.settings),b.mixin=function(a){return e(b.prototype,a),b},b.build=function(a){return new b(a)},b.inherit=function(){return c(b)},b.get=function(a){var c=b.settings||(b.settings={});return c[a]},b.set=function(a,c){var d=b.settings||(b.settings={});return d[a]=c,b},b}function d(){}function e(a,b){if("function"==typeof b)b=b.call(a),b&&e(a,b);else{if("object"!=typeof b)throw new Error("invalid mixin("+b+")");for(var c in b)a[c]=b[c]}}var f=a("./utils");d.prototype.get=function(a){var b=this.settings||(this.settings={});return b[a]},d.prototype.set=function(a,b){var c=this.settings||(this.settings={}),d=arguments.length;if(2==d&&a)c[a]=b;else if(1==d&&"object"==typeof a){var e=a;for(a in e)c[a]=e[a]}else if(d>1||"undefined"!=typeof a)throw new Error("invalid set("+a+", "+b+")");return this},d.prototype.mixin=function(a){return e(this,a),this},b.exports=c(d)},{"./utils":14}],8:[function(a,b){function c(){throw new Error("method not implemented: read")}function d(){throw new Error("method not implemented: write")}function e(){throw new Error("method not implemented: erase")}function f(){throw new Error("method not implemented: exist")}function g(){throw new Error("method not implemented: index")}var h=a("../core/dynamic_mixin"),i={layer:"storage",basepath:"../storage",preload:"storage_preload"};b.exports=function(){function a(){return this.read=this.read||c,this.write=this.write||d,this.erase=this.erase||e,this.exist=this.exist||f,this.index=this.index||g,h.call(this,i)}return a}},{"../core/dynamic_mixin":19}],9:[function(a,b){function c(a,b){var c=this.get("condition_parser")||h.parser;if("function"!=typeof c)throw new Error("invalid condition parser: "+c);var d=c(a),e=this.get("projection_parser")||i.parser;if("function"!=typeof e)throw new Error("invalid projection parser: "+e);var f=e(b),j=this.get("cursor")||g;if("function"!=typeof j)throw new Error("invalid cursor class: "+j);return new j(this,d,f)}function d(a,b){return b=b||f,this.find(a).limit(1).toArray(function(a,c){if(a)b(a);else if(c&&c.length){var d=c[0];b(null,d)}else b()}),this}function e(a,b){b=b||f;var c=this.find(a);return c.count(b),this}function f(){}var g=a("../core/cursor"),h=a("../core/condition"),i=a("../core/projection");b.exports=function(){var a={};return a.find=c,a.findOne=d,a.count=e,a}},{"../core/cursor":20,"../core/condition":21,"../core/projection":22}],16:[function(a,b){function c(a,b){b=b||k;var c=this.http_endpoint()+a,d=this.http_param(),e={method:"GET",url:c};Object.keys(d)&&(e.form=d),this.request(e,b)}function d(a,b,c){c=c||k;var d=this.http_endpoint()+a,e=this.http_param();e.method="write",e.content=b;var f={method:"POST",url:d,json:e};this.request(f,c)}function e(a,b){b=b||k;var c=this.http_endpoint()+a,d=this.http_param();d.method="erase";var e={method:"POST",url:c,form:d};this.request(e,b)}function f(a,b){b=b||k;var c=this.http_endpoint()+a,d=this.http_param();d.method="exist";var e={method:"POST",url:c,form:d};this.request(e,function(a,c){c=c||{};var d=!!c.exist;b(a,d)})}function g(a){a=a||k;var b=this.http_endpoint(),c=this.http_param();c.method="index";var d={method:"POST",url:b,form:c};this.request(d,function(b,c){c=c||{},a(b,c.index)})}function h(){var a=this.get("http_param")||{},b=m.clone(a);for(var c in b)"function"==typeof b[c]&&(b[c]=b[c]());return b}function i(){var a=this.get("endpoint");if(!a)throw new Error("endpoint not defined");return a.replace(/\/*$/,"/")}function j(){throw new Error("request() not implemented")}function k(){}var l=a("./encode"),m=a("../core/utils");b.exports=function(){var a=l.call(this);return a.read=c,a.write=d,a.erase=e,a.exist=f,a.index=g,a.request=j,a.http_endpoint=i,a.http_param=h,a}},{"./encode":15,"../core/utils":14}],18:[function(a,b){b.exports={name:"kagodb",version:"0.2.2",repository:"https://github.com/kawanet/kagodb.git",dependencies:{express:"*","js-yaml":"*",request:"*"},devDependencies:{chai:"*",grunt:"*","grunt-mocha-test":"*","grunt-contrib-jshint":"*","grunt-jsdoc":"*","grunt-browserify":"*","grunt-contrib-uglify":"*",async:"*",jquery:"*"}}},{}],21:[function(a,b,c){c.parser=function(a){if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)throw new Error("unknown condition: "+a);var b=Object.keys(a);if(!b.length)return null;if(1==b.length){var c=b[0],d=a[c];if("object"!=typeof d)return function(a){return a[c]==d}}return function(b){for(var c in a)if(b[c]!=a[c])return!1;return!0}}},{}],22:[function(a,b,c){c.parser=function(a){if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)throw new Error("unknown projection: "+a);var b=Object.keys(a);if(!b.length)return null;if(1==b.length){var c=b[0];if(a[c])return function(a){var b={};return b[c]=a[c],b}}return function(b){var c={};for(var d in a)a[d]&&(c[d]=b[d]);return c}}},{}],19:[function(a,b){function c(b){var c="_"+b.layer,d=this[c];if(d)return d;if(d=this.get(b.layer),!d)throw new Error(b.layer+" not specified");var e=d+"";if("function"!=typeof d){var f={};if(b.preload&&(f=this.get(b.preload)||{}),f[e])d=f[e];else{if(e.search(/^\w[\w\-\.]*$/)<0)throw new Error("invalid "+b.layer+" name: "+e);if(b.basepath)try{d=a(b.basepath+"/"+e)}catch(g){throw new Error(b.layer+" require failed: "+g)}}if(!d)throw new Error("invalid "+b.layer+" class: "+e)}for(;"function"==typeof d;)d=d.call(this);for(var h in d)this[h]||(this[h]=d[h]);return this[c]=d,d}var d=a("../core/intercept_mixin");b.exports=function(a){function b(){return d.call(this,e)}function e(b,d){return function(){var e=c.call(this,a)||{};return d=e[b]||d,d.apply(this,arguments)}}return b}},{"../core/intercept_mixin":23}],20:[function(a,b){function c(a,b,c){this.collection=a,this.condition=b,this.projection=c,this.filters={}}function d(){}a("./utils"),b.exports=c,c.prototype.index=function(a){var b=this;return a=a||d,b._index?a(null,b._index):b.collection.index(function(c,d){a(c,b._index=d)}),this},c.prototype.toArray=function(a){function b(b){g&&(b=b.sort(g)),h&&(b=b.splice(h)),i&&(b=b.splice(0,i)),c.projection&&(b=b.map(c.projection)),c._values=b,a(null,b)}var c=this;a=a||d;var e=this.condition;if(e&&"function"!=typeof e){var f=new Error("invalid condition: "+e);return a(f),void 0}var g=c.filters.sort,h=c.filters.offset||0,i=c.filters.limit||0,j=h>=0&&i>=1?h+i:0;return c._values?b(c._values):c.index(function(d,f){function g(d,i){if(d)return a(d),void 0;if(i&&(!e||e(i))&&h.push(i),j&&h.length>=j)return b(h),void 0;if(!f.length)return b(h),void 0;var k=f.shift();c.collection.read(k,g)}var h=[];return d?(a(d),void 0):(g(),void 0)}),this},c.prototype.count=function(a){return a=a||d,this.index(function(b,c){b?a(b):a(null,c.length)}),this},c.prototype.sort=function(a){if("object"==typeof a){var b=Object.keys(a),c=b.length,d=function(d,e){for(var f=0;c>f;f++){var g=b[f];if(d[g]<e[g])return-a[g];if(d[g]>e[g])return a[g]}};this.filters.sort=d}else this.filters.sort=a;return this},c.prototype.offset=function(a){return this.filters.offset=a,this},c.prototype.limit=function(a){return this.filters.limit=a,this}},{"./utils":14}],23:[function(a,b){b.exports=function(a){function b(){var b,c,d=this,e={};for(b in d)"_"!=b.substr(0,1)&&"get"!=b&&"set"!=b&&(c=d[b],"function"==typeof c&&(e[b]=c));for(b in e)d[b]=a(b,e[b])}return b}},{}]},{},[1]);